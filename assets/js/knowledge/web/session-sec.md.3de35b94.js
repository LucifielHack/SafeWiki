(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([[33],{163:function(e,a,t){"use strict";t.r(a),t.d(a,"default",(function(){return r}));t(130),t(0);var n=t(93);function c(){return(c=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function b(e,a){if(null==e)return{};var t,n,c=function(e,a){if(null==e)return{};var t,n,c={},b=Object.keys(e);for(n=0;n<b.length;n++)t=b[n],a.indexOf(t)>=0||(c[t]=e[t]);return c}(e,a);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(e);for(n=0;n<b.length;n++)t=b[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(c[t]=e[t])}return c}var o={},s="wrapper";function r(e){var a=e.components,t=b(e,["components"]);return Object(n.b)(s,c({},o,t,{components:a,mdxType:"MDXLayout"}),Object(n.b)("h1",{className:"__internal",id:"会话管理漏洞"},"会话管理漏洞",Object(n.b)("a",c({parentName:"h1"},{href:"#%E4%BC%9A%E8%AF%9D%E7%AE%A1%E7%90%86%E6%BC%8F%E6%B4%9E","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("h1",{className:"__internal",id:"会话劫持"},"会话劫持",Object(n.b)("a",c({parentName:"h1"},{href:"#%E4%BC%9A%E8%AF%9D%E5%8A%AB%E6%8C%81","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("h2",{className:"__internal",id:"原理"},"原理",Object(n.b)("a",c({parentName:"h2"},{href:"#%E5%8E%9F%E7%90%86","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("blockquote",null,Object(n.b)("p",{parentName:"blockquote"},"会话劫持（Session hijacking），这是一种通过获取用户 Session ID 后，使用该 Session ID 登录目标账号的攻击方法，"),Object(n.b)("p",{parentName:"blockquote"},"此时攻击者实际上是使用了目标会话固定漏洞基本防御方法 账户的有效 Session。"),Object(n.b)("p",{parentName:"blockquote"},"会话劫持的第一步是取得一个合法的会话标识来伪装成合法用户，因此需要保证会话标识不被泄漏。 ")),Object(n.b)("blockquote",null,Object(n.b)("p",{parentName:"blockquote"},"受害者登录站点，服务器返回一个会话标识(Session ID)"),Object(n.b)("p",{parentName:"blockquote"},"黑客捕获这个",Object(n.b)("strong",{parentName:"p"},"Session ID"),"（ 网络嗅探，XSS ），使用这个Session ID访问站点获得受害者合法会话")),Object(n.b)("h2",{className:"__internal",id:"防御方法"},"防御方法",Object(n.b)("a",c({parentName:"h2"},{href:"#%E9%98%B2%E5%BE%A1%E6%96%B9%E6%B3%95","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("blockquote",null,Object(n.b)("p",{parentName:"blockquote"},Object(n.b)("strong",{parentName:"p"},"XSS漏洞引起的会话劫持："),"使用http-only来防止JS获取cookie中的Session ID信息"),Object(n.b)("p",{parentName:"blockquote"},Object(n.b)("strong",{parentName:"p"},"网络嗅探引起的会话劫持："),"使用HTTPS+secure来保证Session ID不被嗅探获取到")),Object(n.b)("h3",{className:"__internal",id:"session机制"},"Session机制",Object(n.b)("a",c({parentName:"h3"},{href:"#session%E6%9C%BA%E5%88%B6","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("p",null,"Session机制是一种",Object(n.b)("strong",{parentName:"p"},"服务器端"),"的机制，服务器使用一种类似于散列表的结构来保存信息用于保持状态。"),Object(n.b)("p",null,"保存这个Session ID最为方便的方式是采用Cookie。"),Object(n.b)("blockquote",null,Object(n.b)("p",{parentName:"blockquote"},"Cookie的名字都是类似于SESSIONID；"),Object(n.b)("p",{parentName:"blockquote"},"weblogic对于web应用程序生成的cookie，JSESSIONID；"),Object(n.b)("p",{parentName:"blockquote"},"PHP中Session的默认名称是PHPSESSID。")),Object(n.b)("h3",{className:"__internal",id:"cookie属性"},"Cookie属性",Object(n.b)("a",c({parentName:"h3"},{href:"#cookie%E5%B1%9E%E6%80%A7","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("h4",{className:"__internal",id:"httponly设置方法"},"HttpOnly设置方法",Object(n.b)("a",c({parentName:"h4"},{href:"#httponly%E8%AE%BE%E7%BD%AE%E6%96%B9%E6%B3%95","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("p",null,"服务端发送cookie的时候，可以设置HTTP-Only ，禁止JS获取Cookie内容"),Object(n.b)("div",{className:"rcpress-highlight","data-language":"http"},Object(n.b)("pre",c({parentName:"div"},{className:"language-http"}),Object(n.b)("code",c({parentName:"pre"},{className:"language-http"}),Object(n.b)("span",c({parentName:"code"},{className:"token header-name keyword"}),"Set-Cookie:")," SESSIONID=abc123; expires=Wednesday, 17-Nov-99 23:12:40 GMT; HttpOnly"))),Object(n.b)("h4",{className:"__internal",id:"secure"},"Secure",Object(n.b)("a",c({parentName:"h4"},{href:"#secure","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("p",null,"设置cookie的某个值secure为True时， 此cookie只有在HTTPS协议中才会进行传输 "),Object(n.b)("p",null,"HTTP协议传输时，是不传输此协议的。 "),Object(n.b)("h1",{className:"__internal",id:"会话固定"},"会话固定",Object(n.b)("a",c({parentName:"h1"},{href:"#%E4%BC%9A%E8%AF%9D%E5%9B%BA%E5%AE%9A","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("h2",{className:"__internal",id:"原理-1"},"原理",Object(n.b)("a",c({parentName:"h2"},{href:"#%E5%8E%9F%E7%90%86-1","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("blockquote",null,Object(n.b)("p",{parentName:"blockquote"},"会话固定（Session fixation）是一种诱骗受害者使用攻击者指定的会话标识（Session ID）的攻击手段。"),Object(n.b)("p",{parentName:"blockquote"},"这是攻击者获取合法会话标识的最简单的方法。"),Object(n.b)("p",{parentName:"blockquote"},"会话固定也可以看成是会话劫持的一种类型，原因是会话固定的攻击的主要目的同样是获得目标用户的合法会话"),Object(n.b)("p",{parentName:"blockquote"},"不过会话固定还可以是强迫受害者使用攻击者设定的一个有效会话，以此来获得用户的敏感信息。")),Object(n.b)("blockquote",null,Object(n.b)("ul",{parentName:"blockquote"},Object(n.b)("li",c({parentName:"ul"},{className:"__internal"}),"访问网站时，网站会设置cookie中的Session ID"),Object(n.b)("li",c({parentName:"ul"},{className:"__internal"}),Object(n.b)("strong",{parentName:"li"},"当用户登录后，cookie中的SessionID保持不变"),"（",Object(n.b)("strong",{parentName:"li"},"形成原因"),"）"),Object(n.b)("li",c({parentName:"ul"},{className:"__internal"}),"只要获取登陆前的Session ID内容，就可以知道登陆后的Session ID"),Object(n.b)("li",c({parentName:"ul"},{className:"__internal"}),"黑客用该Session ID构造链接，发送给受害者点击后，黑客成功劫持受害者的会话"))),Object(n.b)("h2",{className:"__internal",id:"漏洞检测"},"漏洞检测",Object(n.b)("a",c({parentName:"h2"},{href:"#%E6%BC%8F%E6%B4%9E%E6%A3%80%E6%B5%8B","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("blockquote",null,Object(n.b)("p",{parentName:"blockquote"},Object(n.b)("strong",{parentName:"p"},"访问网站（未登录）："),"获取cookie信息，获取Session ID"),Object(n.b)("p",{parentName:"blockquote"},Object(n.b)("strong",{parentName:"p"},"登录网站："),"查看Cookie信息，获取Session ID"),Object(n.b)("p",{parentName:"blockquote"},Object(n.b)("strong",{parentName:"p"},"查看登录前，登录后SessionID是否相同")," ")),Object(n.b)("h2",{className:"__internal",id:"防御方法-1"},"防御方法",Object(n.b)("a",c({parentName:"h2"},{href:"#%E9%98%B2%E5%BE%A1%E6%96%B9%E6%B3%95-1","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("p",null,"1、在用户登录成功后重新创建一个Session ID，使登录前的匿名会话强制失效 "),Object(n.b)("div",{className:"rcpress-highlight","data-language":"php"},Object(n.b)("pre",c({parentName:"div"},{className:"language-php"}),Object(n.b)("code",c({parentName:"pre"},{className:"language-php"}),Object(n.b)("span",c({parentName:"code"},{className:"token comment"}),"// 会话失效"),"\nsession",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"invalidate"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(n.b)("span",c({parentName:"code"},{className:"token comment"}),"// 会话重建"),"\nsession",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"request",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"getSession"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token boolean constant"}),"true"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),";")))),Object(n.b)("p",null,"2、",Object(n.b)("strong",{parentName:"p"},"SessionID与浏览器绑定："),"SessionID与所访问浏览器有变化，立即重置 "),Object(n.b)("p",null,"3、",Object(n.b)("strong",{parentName:"p"},"SessionID与所访问的IP绑定："),"SessionID与所访问IP有变化，立即重置 "))}r.isMDXComponent=!0,r=r}}]);