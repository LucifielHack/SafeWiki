(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([[19],{161:function(e,t,a){"use strict";a.r(t),function(e){a.d(t,"default",(function(){return u}));var n,c=a(95),o=(a(139),a(0),a(96));function b(){return(b=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function p(e,t){if(null==e)return{};var a,n,c=function(e,t){if(null==e)return{};var a,n,c={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(c[a]=e[a]);return c}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(c[a]=e[a])}return c}(n="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&n(e);"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;var r,s,l=function(e){return function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),Object(o.b)("div",t)}},m={},i="wrapper";function u(e){var t=e.components,a=p(e,["components"]);return Object(o.b)(i,b({},m,a,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h1",{className:"__internal",id:"提高攻击成本，减少攻击意愿"},"提高攻击成本，减少攻击意愿",Object(o.b)("a",b({parentName:"h1"},{href:"#%E6%8F%90%E9%AB%98%E6%94%BB%E5%87%BB%E6%88%90%E6%9C%AC%EF%BC%8C%E5%87%8F%E5%B0%91%E6%94%BB%E5%87%BB%E6%84%8F%E6%84%BF","aria-hidden":!0,className:"anchor"}),"#")),Object(o.b)("h2",{className:"__internal",id:"部署蜜罐"},"部署蜜罐",Object(o.b)("a",b({parentName:"h2"},{href:"#%E9%83%A8%E7%BD%B2%E8%9C%9C%E7%BD%90","aria-hidden":!0,className:"anchor"}),"#")),Object(o.b)("p",null,"如果客户购买了带有攻击者画像功能的现在蜜罐设备，那就爽歪歪了，等着上钩就行；"),Object(o.b)("p",null,"如果没有的话，可以自己学习一下蜜罐的知识，下边是推荐资源"),Object(o.b)("p",null,Object(o.b)("a",b({parentName:"p"},{href:"https://github.com/paralax/awesome-honeypots/blob/master/README_CN.md",target:"_blank"}),"最优秀的蜜罐列表")),Object(o.b)("p",null,Object(o.b)("a",b({parentName:"p"},{href:"https://ipot.sec-wiki.com/",target:"_blank"}),"蜜罐技术研究小组")),Object(o.b)("p",null,"请欣赏奇安信",Object(o.b)("inlineCode",{parentName:"p"},"归零Null"),"师傅的",Object(o.b)("a",b({parentName:"p"},{href:"https://mp.weixin.qq.com/s/m4I_YDn98K_A2yGAhv67Gg",target:"_blank"}),"MySQL蜜罐获取攻击者微信ID")),Object(o.b)("h2",{className:"__internal",id:"废掉攻击者的手段"},"废掉攻击者的手段",Object(o.b)("a",b({parentName:"h2"},{href:"#%E5%BA%9F%E6%8E%89%E6%94%BB%E5%87%BB%E8%80%85%E7%9A%84%E6%89%8B%E6%AE%B5","aria-hidden":!0,className:"anchor"}),"#")),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"本地密码抓取的防御方法")),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},'1、2012 R2之后的版本，把用户放入 ->  "受保护的用户" 的用户组，就不能抓取明文密码和散列值了。'),Object(o.b)("p",{parentName:"blockquote"},"2、安装",Object(o.b)("inlineCode",{parentName:"p"},"KB2871997"),"，并禁用",Object(o.b)("inlineCode",{parentName:"p"},"Administrator"),"账号（SID为500的账户，防止哈希传递攻击）")),Object(o.b)("p",null,"Windows Server 2012 之后的版本默认关闭",Object(o.b)("inlineCode",{parentName:"p"},"Wdigest"),"，无法从内存中获取明文密码。"),Object(o.b)("p",null,"2012之前的版本安装了",Object(o.b)("inlineCode",{parentName:"p"},"KB2871997"),"，同样无法获取明文密码。"),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"开启和关闭",Object(o.b)("inlineCode",{parentName:"strong"},"Wdigest"),"的命令")),Object(o.b)("div",{className:"rcpress-highlight","data-language":"bash"},Object(o.b)("pre",b({parentName:"div"},{className:"language-bash"}),Object(o.b)("code",b({parentName:"pre"},{className:"language-bash"}),Object(o.b)("span",b({parentName:"code"},{className:"token comment"}),"#开启，值为1"),"\nreg ",Object(o.b)("span",b({parentName:"code"},{className:"token function"}),"add")," HKLM",Object(o.b)("span",b({parentName:"code"},{className:"token punctuation"}),"\\"),"SYSTEM",Object(o.b)("span",b({parentName:"code"},{className:"token punctuation"}),"\\"),"CurrentControlSet",Object(o.b)("span",b({parentName:"code"},{className:"token punctuation"}),"\\"),"Control",Object(o.b)("span",b({parentName:"code"},{className:"token punctuation"}),"\\"),"SecurityProviders",Object(o.b)("span",b({parentName:"code"},{className:"token punctuation"}),"\\"),"WDigest /v UseLogonCredential /t REG_DWORD /d ",Object(o.b)("span",b({parentName:"code"},{className:"token number"}),"1")," /f\n\n",Object(o.b)("span",b({parentName:"code"},{className:"token comment"}),"#关闭，值为0"),"\nreg ",Object(o.b)("span",b({parentName:"code"},{className:"token function"}),"add")," HKLM",Object(o.b)("span",b({parentName:"code"},{className:"token punctuation"}),"\\"),"SYSTEM",Object(o.b)("span",b({parentName:"code"},{className:"token punctuation"}),"\\"),"CurrentControlSet",Object(o.b)("span",b({parentName:"code"},{className:"token punctuation"}),"\\"),"Control",Object(o.b)("span",b({parentName:"code"},{className:"token punctuation"}),"\\"),"SecurityProviders",Object(o.b)("span",b({parentName:"code"},{className:"token punctuation"}),"\\"),"WDigest /v UseLogonCredential /t REG_DWORD /d ",Object(o.b)("span",b({parentName:"code"},{className:"token number"}),"0")," /f"))),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Webshell管理工具（冰蝎、蚁剑、哥斯拉等）")),Object(o.b)("p",null,"分析工具的流量特征，在WAF等防护设备上添加自定义规则"),Object(o.b)("div",{className:"rcpress-highlight","data-language":"bash"},Object(o.b)("pre",b({parentName:"div"},{className:"language-bash"}),Object(o.b)("code",b({parentName:"pre"},{className:"language-bash"}),Object(o.b)("span",b({parentName:"code"},{className:"token punctuation"}),"("),"uri_path * rco ",Object(o.b)("span",b({parentName:"code"},{className:"token punctuation"}),"\\"),".",Object(o.b)("span",b({parentName:"code"},{className:"token punctuation"}),"("),"jsp",Object(o.b)("span",b({parentName:"code"},{className:"token operator"}),"|"),"jspx",Object(o.b)("span",b({parentName:"code"},{className:"token operator"}),"|"),"php",Object(o.b)("span",b({parentName:"code"},{className:"token punctuation"}),")"),"$",Object(o.b)("span",b({parentName:"code"},{className:"token punctuation"}),")"),Object(o.b)("span",b({parentName:"code"},{className:"token operator"}),"&&"),Object(o.b)("span",b({parentName:"code"},{className:"token punctuation"}),"("),"method * belong POST",Object(o.b)("span",b({parentName:"code"},{className:"token punctuation"}),")"),Object(o.b)("span",b({parentName:"code"},{className:"token operator"}),"&&"),Object(o.b)("span",b({parentName:"code"},{className:"token punctuation"}),"("),"request_body * req ^",Object(o.b)("span",b({parentName:"code"},{className:"token punctuation"}),"["),Object(o.b)("span",b({parentName:"code"},{className:"token punctuation"}),"\\"),"w+/",Object(o.b)("span",b({parentName:"code"},{className:"token punctuation"}),"]"),Object(o.b)("span",b({parentName:"code"},{className:"token punctuation"}),"{"),Object(o.b)("span",b({parentName:"code"},{className:"token number"}),"1000"),",",Object(o.b)("span",b({parentName:"code"},{className:"token punctuation"}),"}"),Object(o.b)("span",b({parentName:"code"},{className:"token operator"}),"="),"?",Object(o.b)("span",b({parentName:"code"},{className:"token operator"}),"="),"?$",Object(o.b)("span",b({parentName:"code"},{className:"token punctuation"}),")")))),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"防御mimikatz攻击")),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"mimikatz"),"在抓取明文密码或散列值时，需要Debug权限。"),Object(o.b)("p",null,"因为",Object(o.b)("inlineCode",{parentName:"p"},"mimikatz"),"需要和",Object(o.b)("inlineCode",{parentName:"p"},"lsass"),"进程进行交互，没有",Object(o.b)("inlineCode",{parentName:"p"},"Debug"),"权限的话",Object(o.b)("inlineCode",{parentName:"p"},"mimikatz"),"将不能读取",Object(o.b)("inlineCode",{parentName:"p"},"lsass"),"进程。"),Object(o.b)("p",null,"因此，将拥有Debug权限的本地管理员从",Object(o.b)("inlineCode",{parentName:"p"},"Administrators"),"组中删除即可。"),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"其它内网渗透工具")),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"CobaltStrike、Metasploit等c2工具"),Object(o.b)("p",{parentName:"blockquote"},"frp、nps、reGeorg、ew、Termite、lcx等通道构建工具"),Object(o.b)("p",{parentName:"blockquote"},"impacket工具包"),Object(o.b)("p",{parentName:"blockquote"},Object(o.b)("strong",{parentName:"p"},"具体做法："),"分析工具流量特征，在WAF等防护设备上自定义相关规则"),Object(o.b)("p",{parentName:"blockquote"},Object(o.b)("strong",{parentName:"p"},"可参考：")," ",Object(o.b)("a",b({parentName:"p"},{href:"https://xz.aliyun.com/t/7606",target:"_blank"}),"加密Webshell“冰蝎” 流量 100%识别")," ")),Object(o.b)("h1",{className:"__internal",id:"溯源攻击者"},"溯源攻击者",Object(o.b)("a",b({parentName:"h1"},{href:"#%E6%BA%AF%E6%BA%90%E6%94%BB%E5%87%BB%E8%80%85","aria-hidden":!0,className:"anchor"}),"#")),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"1、通过威胁情报分析，溯源IP\t（微步、QAX威胁情报中心等）"),Object(o.b)("p",{parentName:"blockquote"},"2、反向渗透攻击者VPS"),Object(o.b)("p",{parentName:"blockquote"},"3、社工攻击者虚拟身份、真实身份（通过攻击者的常用shell特征、VPS地址信息、常用ID等入手）"),Object(o.b)("p",{parentName:"blockquote"},"如果能确认攻击者的邮箱或QQ等信息，社工库机器人走一波就差不多了")),Object(o.b)("p",null,"详细过程建议参考以下文章："),Object(o.b)("p",null,Object(o.b)("a",b({parentName:"p"},{href:"https://paper.seebug.org/945/#357-philipbeekoohk",target:"_blank"}),"如何通过一封恶意邮件追踪幕后黑客组织")))}u.isMDXComponent=!0,u=Object(c.hot)(e)(u),(r="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(r.register(l,"makeShortcode","E:\\Code\\Project\\wgpsec\\WgpsecWiki\\docs\\knowledge\\hw\\back-counter.md"),r.register(m,"layoutProps","E:\\Code\\Project\\wgpsec\\WgpsecWiki\\docs\\knowledge\\hw\\back-counter.md"),r.register(i,"MDXLayout","E:\\Code\\Project\\wgpsec\\WgpsecWiki\\docs\\knowledge\\hw\\back-counter.md"),r.register(u,"MDXContent","E:\\Code\\Project\\wgpsec\\WgpsecWiki\\docs\\knowledge\\hw\\back-counter.md")),(s="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&s(e)}.call(this,a(23)(e))}}]);