(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{735:function(s,t,a){"use strict";a.r(t);var e=a(103),r=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"应用简介"}},[s._v("应用简介 "),a("a",{staticClass:"header-anchor",attrs:{href:"#应用简介"}},[s._v("#")])]),s._v(" "),a("p",[s._v("Apache HTTPD是一款HTTP服务器，它可以通过mod_php来运行PHP网页。")]),s._v(" "),a("h2",{attrs:{id:"cve-2017-15715-httpd-换行解析漏洞"}},[s._v("[CVE-2017-15715]-HTTPD 换行解析漏洞 "),a("a",{staticClass:"header-anchor",attrs:{href:"#cve-2017-15715-httpd-换行解析漏洞"}},[s._v("#")])]),s._v(" "),a("p",[a("strong",[s._v("漏洞概述")])]),s._v(" "),a("div",{staticClass:"language-http line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[s._v("#影响版本\n2.4.0~2.4.29\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("在解析PHP时，"),a("code",[s._v("1.php\\x0A")]),s._v("将被按照PHP后缀进行解析，导致绕过一些服务器的安全策略")]),s._v(" "),a("p",[a("strong",[s._v("漏洞利用")])]),s._v(" "),a("p",[s._v("上传文件时，在1.php后面插入一个"),a("code",[s._v("\\x0A")]),s._v("（注意，不能是"),a("code",[s._v("\\x0D\\x0A")]),s._v("，只能是一个"),a("code",[s._v("\\x0A")]),s._v("）")]),s._v(" "),a("p",[s._v("访问刚才上传的"),a("code",[s._v("/1.php%0a")]),s._v("，发现能够成功解析")]),s._v(" "),a("h2",{attrs:{id:"配置错误-httpd-多后缀解析漏洞"}},[s._v("[配置错误]-HTTPD 多后缀解析漏洞 "),a("a",{staticClass:"header-anchor",attrs:{href:"#配置错误-httpd-多后缀解析漏洞"}},[s._v("#")])]),s._v(" "),a("p",[a("strong",[s._v("漏洞概述")])]),s._v(" "),a("p",[s._v("Apache HTTPD 支持一个文件拥有多个后缀，并为不同后缀执行不同的指令。比如，如下配置文件：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("AddType text/html .html\nAddLanguage zh-CN .cn\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("其给"),a("code",[s._v(".html")]),s._v("后缀增加了media-type，值为"),a("code",[s._v("text/html")]),s._v("；")]),s._v(" "),a("p",[s._v("给"),a("code",[s._v(".cn")]),s._v("后缀增加了语言，值为"),a("code",[s._v("zh-CN")]),s._v("。")]),s._v(" "),a("p",[s._v("此时，如果用户请求文件"),a("code",[s._v("index.cn.html")]),s._v("，他将返回一个中文的html页面。")]),s._v(" "),a("p",[s._v("以上就是Apache多后缀的特性。如果运维人员给"),a("code",[s._v(".php")]),s._v("后缀增加了处理器：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("AddHandler application/x-httpd-php .php\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("那么，在有多个后缀的情况下，只要一个文件含有"),a("code",[s._v(".php")]),s._v("后缀的文件即将被识别成PHP文件，没必要是最后一个后缀。利用这个特性，将会造成一个可以绕过上传白名单的解析漏洞。")]),s._v(" "),a("p",[a("strong",[s._v("漏洞利用")])]),s._v(" "),a("p",[s._v("上传文件名为"),a("code",[s._v("xxx.php.jpg")]),s._v("的文件，利用Apache解析漏洞进行getshell")]),s._v(" "),a("p",[a("strong",[s._v("修复建议")])]),s._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//1、使用SetHandler,写好正则")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("FileMatch "),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('".+\\.php$"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nSetHandler application"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("x"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("httpd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("php\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("FileMatch"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//2、禁止.php这样的文件执行")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("FileMatch "),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('".+\\.ph(p[3457]?|t|tml)\\."')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Require")]),s._v(" all denied\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("FileMatch"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h2",{attrs:{id:"配置错误-ssi-远程命令执行漏洞"}},[s._v("[配置错误]-SSI 远程命令执行漏洞 "),a("a",{staticClass:"header-anchor",attrs:{href:"#配置错误-ssi-远程命令执行漏洞"}},[s._v("#")])]),s._v(" "),a("p",[a("strong",[s._v("漏洞概述")])]),s._v(" "),a("p",[s._v("在测试任意文件上传漏洞的时候，目标服务端可能不允许上传php后缀的文件。如果"),a("code",[s._v("目标服务器开启了SSI与CGI支持")]),s._v("，我们可以上传一个shtml文件，并利用"),a("code",[s._v('\x3c!--#exec cmd="id" --\x3e')]),s._v("语法执行任意命令")]),s._v(" "),a("p",[a("strong",[s._v("漏洞利用")])]),s._v(" "),a("p",[s._v("上传一个shell.shtml文件，上传成功后访问shell.shtml")])])}),[],!1,null,null,null);t.default=r.exports}}]);